<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>SKU Tracker</title>
</head>
<body>
  <h1>SKU Tracker</h1>
  <input id="sku-input" placeholder="Enter SKU" />
  <button id="add-btn">Add</button>
  <ul id="sku-list"></ul>
  <script>
    async function loadSkus() {
      const res = await fetch('/api/skus');
      const skus = await res.json();
      const list = document.getElementById('sku-list');
      list.innerHTML = '';
      skus.forEach(s => {
        const li = document.createElement('li');
        li.appendChild(document.createTextNode(`${s.id}: ${s.sku} - ${s.title}`));
        if (s.ebayId) {
          li.appendChild(document.createTextNode(` - eBay ID: ${s.ebayId}`));
        }
        const btn = document.createElement('button');
        btn.textContent = s.ebayId ? 'Update eBay ID' : 'Add eBay ID';
        btn.addEventListener('click', async () => {
          const ebayId = prompt('Enter eBay listing ID', s.ebayId || '');
          if (!ebayId) return;
          await fetch(`/api/skus/${s.id}/ebay`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ebayId })
          });
          loadSkus();
        });
        li.appendChild(btn);
        const shipBtn = document.createElement('button');
        shipBtn.textContent = 'Set Shipping Policy';
        shipBtn.disabled = !s.ebayId;
        shipBtn.addEventListener('click', async () => {
          if (!s.ebayId) return alert('Set eBay ID first');
          const resp = await fetch('/api/ebay/set-shipping-policy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ listingId: s.ebayId })
          });
          if (resp.ok) {
            alert('Shipping policy updated');
          } else {
            const msg = await resp.text();
            alert('Failed to update policy: ' + msg);
          }
        });
        li.appendChild(shipBtn);
        list.appendChild(li);
      });
    }
    document.getElementById('add-btn').addEventListener('click', async () => {
      const sku = document.getElementById('sku-input').value.trim();
      if (!sku) return;
      await fetch('/api/skus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sku })
      });
      document.getElementById('sku-input').value = '';
      loadSkus();
    });
    loadSkus();
  </script>
</body>
</html>

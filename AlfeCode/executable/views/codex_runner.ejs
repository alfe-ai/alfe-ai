<!DOCTYPE html>
<html lang="en" class="agent-scale-80">
<head>
    <meta charset="UTF-8">
    <title>Alfe AI - Code</title>
    <meta name="description" content="Alfe AI: FLOSS, Self-hostable, AI Software Development, Chat, and Image Design - a cloud-based code-assistant interface for running and managing agents.">
    <link id="favicon" rel="icon" href="/alfe_favicon_64x64.ico">
    <link rel="alternate icon" href="/alfe_favicon_64x64.ico" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css">
    <style>
        :root {
            color-scheme: dark;
            font-family: "Inter", "Segoe UI", system-ui, sans-serif;
            --bg-gradient: radial-gradient(circle at top left, rgba(124, 58, 237, 0.45), rgba(15, 23, 42, 0.95));
            --bg-main: rgba(15, 23, 42, 0.94);
            --bg-alt: rgba(15, 23, 42, 0.82);
            --surface: rgba(30, 41, 59, 0.92);
            --surface-soft: rgba(51, 65, 85, 0.65);
            --surface-border: rgba(71, 85, 105, 0.45);
            --surface-strong-border: rgba(148, 163, 184, 0.45);
            --text-color: #e2e8f0;
            --text-muted: #94a3b8;
            --accent: #7c3aed;
            --accent-strong: #8b5cf6;
            --accent-soft: rgba(124, 58, 237, 0.28);
            --danger: #f97316;
            --shadow: 0 24px 60px rgba(15, 23, 42, 0.6);
            --runs-sidebar-width: clamp(320px, 26vw, 420px);
            --runs-sidebar-collapsed-width: 56px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: var(--bg-gradient);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
        }

        :root.agent-scale-80 {
            font-size: 80%;
        }

        .agent-scale-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0;
        }

        .agent-scale-container .page-shell {
            width: 100%;
        }

        body.is-resizing,
        body.is-resizing * {
            cursor: col-resize !important;
        }

        .page-shell {
            flex: 1 1 auto;
            width: 100%;
            display: grid;
            grid-template-columns: var(--runs-sidebar-width, clamp(320px, 26vw, 420px)) minmax(0, 1fr);
            gap: 0;
            align-items: stretch;
            padding: 0;
            box-sizing: border-box;
            min-height: 100vh;
        }

        .runs-sidebar-collapsed .page-shell {
            grid-template-columns: var(--runs-sidebar-collapsed-width, 56px) minmax(0, 1fr);
        }

        a {
            color: #fff !important;
            text-decoration: none;
            transition: color 0.2s ease, opacity 0.2s ease;
        }

        a:hover {
            color: var(--accent);
            opacity: 0.85;
        }

        .project-info {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 0.32rem 0.85rem 0.36rem;
            margin: 0;
            border: 1px solid rgba(148, 163, 184, 0.32);
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.16) 0%, rgba(51, 65, 85, 0.26) 100%);
            color: rgba(226, 232, 240, 0.9);
            font: inherit;
            font-size: 0.94rem;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: background 0.22s ease, color 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease, transform 0.16s ease;
        }

        .project-info:hover,
        .project-info:focus-visible,
        .project-info.is-open {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.32) 0%, rgba(99, 102, 241, 0.3) 100%);
            border-color: rgba(167, 139, 250, 0.65);
            color: #f8fafc;
            box-shadow: 0 12px 30px rgba(30, 64, 175, 0.32);
            transform: translateY(-1px);
        }

        .project-info:focus-visible {
            outline: none;
        }

        .project-info__caret {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }
        .repo-caret {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            margin-right: 6px;
            color: inherit;
        }



        .project-info.is-open .project-info__caret {
            transform: rotate(-180deg);
        }

        .project-info__text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-brand {
            margin-bottom: 18px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .sidebar-brand-icon {
            width: 46px;
            height: 46px;
            flex: 0 0 46px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.8) 0%, rgba(45, 212, 191, 0.35) 100%);
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
        }

        .sidebar-brand-icon img {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            display: block;
            object-fit: cover;
        }

        .sidebar-brand-heading {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            display: flex;
            align-items: baseline;
            gap: 0.45rem;
        }

        .sidebar-brand-name {
            color: inherit;
            text-decoration: none;
            font-weight: 700;
            letter-spacing: inherit;
        }

        .sidebar-brand-name:hover {
            color: var(--accent-strong);
        }

        .sidebar-version {
            margin: 0;
            font-size: 0.82rem;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-muted);

            display: flex;
            align-items: center;
            gap: 0.4rem;
            text-transform: none;
        }

        /* Aurora-inspired agent nav */
        .aurora-nav {
            margin: 6px 0 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        /* Collapsed sidebar quick-links */
        .runs-sidebar__collapsed-mini {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 6px 6px 14px;
        }

        .runs-sidebar__collapsed-logo {
            width: 46px;
            height: 46px;
            border-radius: 14px;
            background: radial-gradient(circle at 30% 30%, rgba(124, 58, 237, 0.35), rgba(12, 19, 34, 0.92));
            box-shadow: 0 12px 26px rgba(2, 6, 23, 0.6);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            background-clip: padding-box;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.14);
        }

        .runs-sidebar__collapsed-logo:focus-visible {
            outline: 2px solid rgba(167, 139, 250, 0.7);
            outline-offset: 2px;
        }

        .runs-sidebar__collapsed-logo img {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            display: block;
        }

        .runs-sidebar__collapsed-nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .runs-sidebar__collapsed-nav-link {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(160deg, rgba(255, 255, 255, 0.04), rgba(124, 58, 237, 0.18));
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: rgba(226, 232, 240, 0.9) !important;
            box-shadow: 0 10px 22px rgba(2, 6, 23, 0.65);
            transition: transform 0.16s ease, border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
        }

        .runs-sidebar__collapsed-nav-link:hover,
        .runs-sidebar__collapsed-nav-link:focus-visible {
            transform: translateY(-1px);
            border-color: rgba(167, 139, 250, 0.6);
            box-shadow: 0 14px 26px rgba(30, 64, 175, 0.4);
        }

        .runs-sidebar__collapsed-nav-link.is-active {
            background: linear-gradient(150deg, rgba(59, 130, 246, 0.44), rgba(124, 58, 237, 0.56));
            border-color: rgba(124, 58, 237, 0.52);
            color: #f8fafc !important;
            box-shadow: 0 18px 36px rgba(67, 56, 202, 0.38), inset 0 1px 0 rgba(255, 255, 255, 0.18);
        }

        .sidebar-nav-item {
            width: 100%;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            border-radius: 11px;
            text-align: left;
            font-weight: 600;
            font-size: 0.96rem;
            letter-spacing: 0.01em;
            color: rgba(226, 232, 240, 0.88) !important;
            border: 1px solid rgba(255, 255, 255, 0.02);
            background: linear-gradient(168deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.015));
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.38);
            transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.14s ease, box-shadow 0.2s ease;
        }

        .sidebar-nav-item__icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.04);
            color: rgba(226, 232, 240, 0.92);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 6px 14px rgba(0, 0, 0, 0.25);
        }

        .sidebar-nav-item__label {
            flex: 1 1 auto;
            white-space: nowrap;
        }

        .sidebar-nav-item:hover,
        .sidebar-nav-item:focus-visible {
            color: #e5e7eb !important;
            border-color: rgba(96, 165, 250, 0.32);
            background: linear-gradient(155deg, rgba(59, 130, 246, 0.14), rgba(124, 58, 237, 0.12));
            transform: translateY(-1px);
            box-shadow: 0 16px 34px rgba(37, 99, 235, 0.26);
        }

        .sidebar-nav-item.is-active {
            color: #f8fafc !important;
            border-color: rgba(124, 58, 237, 0.5);
            background: linear-gradient(140deg, rgba(59, 130, 246, 0.46), rgba(124, 58, 237, 0.64));
            box-shadow: 0 18px 36px rgba(67, 56, 202, 0.38), inset 0 1px 0 rgba(255, 255, 255, 0.18);
        }

        .sidebar-version .repo-trigger {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.35rem 0.85rem 0.4rem;
            margin: 0;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.18) 0%, rgba(79, 70, 229, 0.14) 100%);
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 999px;
            box-shadow: 0 8px 22px rgba(2, 6, 23, 0.28);
            font: inherit;
            color: rgba(226, 232, 240, 0.95);
            letter-spacing: inherit;
            text-transform: inherit;
            cursor: pointer;
            max-width: 100%;
            flex: 1 1 auto;
            transition: background 0.22s ease, color 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease, transform 0.16s ease;
        }

        .sidebar-version .repo-trigger:hover,
        .sidebar-version .repo-trigger:focus-visible,
        .sidebar-version .repo-trigger[aria-expanded="true"] {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.32) 0%, rgba(99, 102, 241, 0.28) 100%);
            border-color: rgba(167, 139, 250, 0.65);
            color: #f8fafc;
            box-shadow: 0 12px 30px rgba(30, 64, 175, 0.35);
            transform: translateY(-1px);
        }

        .sidebar-version .repo-trigger:focus-visible {
            outline: none;
        }

        .sidebar-version .repo-trigger__text {
            display: inline-flex;
            align-items: baseline;
            gap: 0.4rem;
            flex: 1 1 auto;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar-version .repo-trigger__text .repo-name {
            display: inline-block;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-version .repo-trigger__text .repo-demo-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #f8fafc;
            background: rgba(124, 58, 237, 0.4);
            border: 1px solid rgba(124, 58, 237, 0.75);
            box-shadow: 0 0 12px rgba(124, 58, 237, 0.35);
            flex: 0 0 auto;
        }

        .sidebar-breadcrumb {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .sidebar-breadcrumb a {
            color: inherit;
        }

        .environment-indicator {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.78rem;
            color: var(--accent);
        }

        .container {
            width: 100%;
            max-width: none;
            background: linear-gradient(180deg, var(--surface) 0%, var(--bg-main) 100%);
            border-radius: 0 24px 24px 0;
            border: 1px solid var(--surface-border);
            border-left: none;
            padding: clamp(24px, 4vw, 48px);
            padding-top: clamp(20px, 3vw, 32px);
            box-shadow: var(--shadow);
            backdrop-filter: blur(18px);
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 0;
            overflow-y: auto;
        }

        /* Neutralize sidebar styling on /agent to remove purple gradient */

        /* Remove purple glow from runs sidebar and backlog/archive buttons */
        /* Overrides to ensure the /agent page doesn't show purple highlights */
        #runsSidebar .runs-sidebar__item,
        #runsSidebar .runs-sidebar__item:not(.is-disabled):hover,
        #runsSidebar .runs-sidebar__item:focus-visible,
        #runsSidebar .runs-sidebar__item.is-active,
        #runsSidebar .runs-sidebar__new-task,
        #runsSidebar .runs-sidebar__primary-action,
        #runsSidebar .runs-sidebar__archive-btn,
        #runsSidebar .runs-sidebar__new-task:hover,
        #runsSidebar .runs-sidebar__icon-button {
            border-color: rgba(148,163,184,0.18) !important;
            box-shadow: none !important;
            background: rgba(15,23,42,0.55) !important;
            outline: none !important;
            transform: none !important;
        }

        #runsSidebar .runs-sidebar__item:not(.is-disabled):hover {
            border-color: rgba(148,163,184,0.28) !important;
        }

        #runsSidebar .runs-sidebar__item.is-active {
            background: rgba(148,163,184,0.06) !important;
        }

        .runs-sidebar__archive-btn {
            box-shadow: none !important;
            border-color: rgba(148,163,184,0.12) !important;
            background: rgba(15,23,42,0.85) !important;
            color: var(--text-color) !important;
        }

        .runs-sidebar__new-task {
            background: linear-gradient(135deg, rgba(148,163,184,0.95) 0%, rgba(120,130,150,0.95) 100%) !important;
            box-shadow: none !important;
            color: #ffffff !important;
        }

        #runsSidebar .runs-sidebar__icon-button {
            box-shadow: 0 8px 22px rgba(2, 6, 23, 0.28) !important;
            border-color: rgba(148,163,184,0.35) !important;
            color: rgba(226,232,240,0.95) !important;
            background: linear-gradient(135deg, rgba(148,163,184,0.18) 0%, rgba(79,70,229,0.14) 100%) !important;
        }

        #runsSidebar .runs-sidebar__icon-button:hover,
        #runsSidebar .runs-sidebar__icon-button:focus-visible {
            background: linear-gradient(135deg, rgba(124,58,237,0.32) 0%, rgba(99,102,241,0.28) 100%) !important;
            border-color: rgba(167,139,250,0.65) !important;
            color: #f8fafc !important;
            box-shadow: 0 12px 30px rgba(30,64,175,0.35) !important;
            transform: translateY(-1px) !important;
        }

        body {
            background: #0b1120 !important;
        }

        #runsSidebar {
            position: relative;
            background: #0f172a !important;
            background-image: none !important;
            border: 1px solid var(--surface-border) !important;
            border-left: none !important;
            box-shadow: none !important;
            backdrop-filter: none !important;
            border-radius: 0 !important;
        }

        #runsSidebar .runs-sidebar__header,
        #runsSidebar .runs-sidebar__title-group,
        #runsSidebar .runs-sidebar__primary-action,
        #runsSidebar .runs-sidebar__body {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

        #runsSidebar .runs-sidebar__header,
        #runsSidebar .runs-sidebar__title-group {
            padding-right: clamp(12px, 2vw, 20px);
            overflow: visible;
        }

        #runsSidebar .runs-sidebar__new-task {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95) 0%, rgba(139, 92, 246, 0.98) 100%) !important;
            box-shadow: 0 18px 32px rgba(124, 58, 237, 0.28) !important;
            color: #fff !important;
        }

        #runsSidebar .runs-sidebar__new-task:hover,
        #runsSidebar .runs-sidebar__new-task:focus-visible {
            filter: none !important;
            transform: none !important;
            box-shadow: none !important;
            background: var(--surface-soft) !important;
        }

        .runs-sidebar {
            background: linear-gradient(180deg, var(--surface) 0%, var(--bg-main) 100%);
            border-radius: 24px 0 0 24px;
            border: 1px solid var(--surface-border);
            padding: clamp(20px, 3vw, 28px);
            padding-top: clamp(8px, 1.6vw, 18px);
            box-shadow: var(--shadow);
            backdrop-filter: blur(18px);
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0; /* allow proper flex shrinking to avoid layout jumps */
            height: 100%;
            overflow: visible; /* allow dropdown iframes to escape the sidebar bounds */
            position: relative;
            z-index: 2; /* ensure overlays stack above adjacent content */
            width: var(--runs-sidebar-width, clamp(320px, 26vw, 420px));
            max-width: 100%;
        }

        .runs-sidebar-collapsed #runsSidebar {
            width: var(--runs-sidebar-collapsed-width, 56px);
            min-width: var(--runs-sidebar-collapsed-width, 56px);
            padding: 14px 10px;
            border-radius: 0 0 0 0;
            gap: 0;
        }
        /* Ensure the list can shrink and scroll without forcing parent height */
        .runs-sidebar__list { flex: 1 1 auto; min-height: 0; }

        .runs-sidebar__resizer {
            position: absolute;
            top: 0;
            right: -8px;
            width: 16px;
            height: 100%;
            cursor: col-resize;
            z-index: 1200;
            display: block;
            background: linear-gradient(90deg, rgba(0,0,0,0), rgba(255,255,255,0.02), rgba(0,0,0,0));
            border-radius: 8px;
        }

        /* Visible handle for desktop */
        .runs-sidebar__resizer::before {
            content: '';
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 36px;
            background: rgba(148,163,184,0.18);
            border-radius: 2px;
            box-shadow: 0 0 0 4px rgba(148,163,184,0.02);
        }

        .runs-sidebar__body {
            position: relative;
            flex: 1 1 auto;
            min-height: 0;
            display: flex;
        }

        .runs-sidebar__pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 12px 16px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.72) 0%, rgba(15, 23, 42, 0.45) 100%);
            border: 1px solid rgba(148, 163, 184, 0.18);
            color: rgba(226, 232, 240, 0.82);
            font-size: 0.85rem;
        }
        .runs-sidebar__pagination.is-hidden { display: none; }

        .runs-sidebar__pagination-center {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.35rem;
            min-width: 0;
        }

        .runs-sidebar__pagination-button {
            flex: 0 0 auto;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.2) 0%, rgba(79, 70, 229, 0.16) 100%);
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 999px;
            color: rgba(226, 232, 240, 0.92);
            padding: 0.35rem 0.9rem;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .runs-sidebar__pagination-button:hover,
        .runs-sidebar__pagination-button:focus-visible {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(99, 102, 241, 0.28) 100%);
            border-color: rgba(167, 139, 250, 0.6);
            color: #f8fafc;
            outline: none;
            box-shadow: 0 10px 24px rgba(30, 64, 175, 0.32);
        }
        .runs-sidebar__pagination-button[disabled] {
            opacity: 0.45;
            cursor: not-allowed;
            box-shadow: none;
        }

        .runs-sidebar__pagination-indicator {
            text-align: center;
            color: rgba(203, 213, 225, 0.9);
            font-weight: 500;
        }

        .runs-sidebar__archive-all-button {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.42) 0%, rgba(37, 99, 235, 0.3) 100%);
            border: 1px solid rgba(96, 165, 250, 0.45);
            border-radius: 999px;
            color: #e2e8f0;
            padding: 0.3rem 0.85rem;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .runs-sidebar__archive-all-button:hover,
        .runs-sidebar__archive-all-button:focus-visible {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.55) 0%, rgba(59, 130, 246, 0.4) 100%);
            border-color: rgba(147, 197, 253, 0.8);
            color: #f8fafc;
            outline: none;
            box-shadow: 0 10px 24px rgba(30, 64, 175, 0.32);
        }
        .runs-sidebar__archive-all-button[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .runs-sidebar__footer {
            margin-top: 4px;
            padding: 12px 16px;
            font-size: 0.82rem;
            color: rgba(203, 213, 225, 0.7);
            text-align: left;
            border-top: 1px solid rgba(148, 163, 184, 0.12);
            position: sticky;
            bottom: 0;
            left: 0;
            align-self: flex-start;
            width: 100%;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.95) 0%, rgba(15, 23, 42, 0.88) 100%);
            z-index: 3;
        }
        .runs-sidebar__footer-links {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            width: 100%;
        }
        .runs-sidebar__footer a {
            color: inherit;
            text-decoration: none;
            font-weight: 600;
        }
        .runs-sidebar__footer a:hover,
        .runs-sidebar__footer a:focus-visible {
            color: #f8fafc;
            text-decoration: underline;
        }

        .github-link-button {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.55rem 0.85rem;
            min-height: 36px;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: #1e293b;
            color: inherit;
            font-weight: 700;
            line-height: 1;
            cursor: pointer;
            text-decoration: none;
            transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .github-link-button:hover,
        .github-link-button:focus-visible {
            border-color: #a78bfa;
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(124, 58, 237, 0.22);
        }

        .github-link-icon svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .runs-sidebar__primary-action {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 4px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.18) 0%, rgba(15, 23, 42, 0.65) 100%);
            border: 1px solid rgba(124, 58, 237, 0.35);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .runs-sidebar__new-task {
            width: 100%;
            flex: 1 1 auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 16px;
            border-radius: 14px;
            border: none;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95) 0%, rgba(139, 92, 246, 0.98) 100%);
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            cursor: pointer;
            box-shadow: 0 18px 32px rgba(124, 58, 237, 0.28);
            transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
        }

        .runs-sidebar__new-task:hover,
        .runs-sidebar__new-task:focus-visible {
            transform: translateY(-1px);
            box-shadow: 0 22px 40px rgba(124, 58, 237, 0.32);
            filter: brightness(1.05);
            outline: none;
        }

        .runs-sidebar__new-task:active {
            transform: translateY(0);
            box-shadow: 0 16px 26px rgba(124, 58, 237, 0.24);
        }

        .runs-sidebar__new-task[disabled] {
            opacity: 0.65;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            filter: saturate(0.7);
        }

        .runs-sidebar__new-task-icon {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.35);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .runs-sidebar__new-task-label {
            white-space: nowrap;
        }

        .runs-sidebar__icon-button {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.18) 0%, rgba(79, 70, 229, 0.14) 100%);
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 999px;
            color: rgba(226, 232, 240, 0.92);
            padding: 0.35rem 0.95rem 0.4rem;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            cursor: pointer;
            box-shadow: 0 8px 22px rgba(2, 6, 23, 0.28);
            transition: background 0.22s ease, color 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease, transform 0.18s ease;
        }

        .runs-sidebar__icon-button:hover,
        .runs-sidebar__icon-button:focus-visible {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.32) 0%, rgba(99, 102, 241, 0.28) 100%);
            border-color: rgba(167, 139, 250, 0.65);
            color: #f8fafc;
            box-shadow: 0 12px 30px rgba(30, 64, 175, 0.35);
            outline: none;
            transform: translateY(-1px);
        }

        .runs-sidebar__icon-button:disabled {
            opacity: 0.45;
            cursor: not-allowed;
            transform: none;
        }

        .runs-sidebar__hint {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .runs-sidebar__list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            padding-right: 4px;
            margin-top: -2px;
        }

        .runs-sidebar__list::-webkit-scrollbar {
            width: 6px;
        }

        .runs-sidebar__list::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.25);
            border-radius: 999px;
        }

        .runs-sidebar__item {
            position: relative;
            border: 1px solid var(--surface-border);
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.55);
            color: inherit;
            padding: 14px 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: left;
            cursor: pointer;
            transition: border-color 0.2s ease, background 0.2s ease, transform 0.18s ease, box-shadow 0.2s ease;
        }

        .runs-sidebar__archive-btn {
            position: absolute;
            right: 12px;
            top: 50% !important;
            transform: translateY(-50%) !important;
            will-change: transform;
            opacity: 0;
            transition: opacity 0.12s ease;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(148,163,184,0.18);
            color: var(--text-color);
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 0.82rem;
            cursor: pointer;
        }
        .runs-sidebar__archive-btn.is-active {
            background: var(--accent) !important;
            border-color: rgba(124,58,237,0.95) !important;
            box-shadow: 0 12px 28px rgba(124,58,237,0.28) !important;
            color: #fff !important;
            transform: translateY(-1px) !important;
        }
        .runs-sidebar__item:hover .runs-sidebar__archive-btn { opacity: 1; }
        /* Scope hover rules to non-disabled items to prevent hover lift on disabled runs */
        .runs-sidebar__item:not(.is-disabled):hover {
            transform: translateY(-1px);
            border-color: rgba(124, 58, 237, 0.65);
            box-shadow: 0 16px 32px rgba(124, 58, 237, 0.22);
        }

        .runs-sidebar__item:focus-visible {
            outline: 2px solid rgba(124, 58, 237, 0.8);
            outline-offset: 2px;
        }

        .runs-sidebar__item.is-active {
            border-color: rgba(124, 58, 237, 0.95);
            background: rgba(124, 58, 237, 0.18);
            box-shadow: 0 18px 34px rgba(124, 58, 237, 0.24);
        }

        .runs-sidebar__item.is-disabled, .runs-sidebar__item[disabled] {
            opacity: 0.55;
            /* keep hand cursor and allow clicks so JS can open disabled items in new tab */
            cursor: pointer;
            pointer-events: auto;
            transform: none;
        }

        .runs-sidebar__item-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 12px;
        }

        .runs-sidebar__item-title {
            font-size: 1rem;
            font-weight: 600;
            color: #f1f5f9;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .runs-sidebar__item-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .runs-sidebar__item-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            letter-spacing: 0.04em;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .runs-sidebar__badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.7rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            border: 1px solid rgba(148, 163, 184, 0.28);
            background: rgba(148, 163, 184, 0.12);
            color: #cbd5f5;
        }

        .runs-sidebar__badge::before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: currentColor;
            opacity: 0.8;
        }

        .runs-sidebar__badge--running {
            background: linear-gradient(120deg, rgba(255, 193, 7, 0.12), rgba(255, 214, 10, 0.32), rgba(255, 193, 7, 0.18));
            background-size: 200% 200%;
            border-color: rgba(255, 214, 10, 0.6);
            color: #ffd000;
            animation: runs-sidebar-running-glow 2.4s ease-in-out infinite;
        }

        @keyframes runs-sidebar-running-glow {
            0% {
                background-position: 0% 50%;
                border-color: rgba(255, 214, 10, 0.45);
                color: #ffd000;
            }

            50% {
                background-position: 100% 50%;
                border-color: rgba(255, 230, 70, 0.85);
                color: #ffe65b;
            }

            100% {
                background-position: 0% 50%;
                border-color: rgba(255, 214, 10, 0.45);
                color: #ffd000;
            }
        }

        .runs-sidebar__badge--merging {
            background: rgba(255, 143, 0, 0.18);
            border-color: rgba(255, 143, 0, 0.35);
            color: #ff8f00;
        }

        .runs-sidebar__badge--merged {
            background: rgba(124, 58, 237, 0.2);
            border-color: rgba(124, 58, 237, 0.4);
            color: #e9d5ff;
        }


        .runs-sidebar__badge--canceled {
            background: rgba(148, 163, 184, 0.12);
            border-color: rgba(148, 163, 184, 0.28);
            color: #cbd5f5;
        }

.runs-sidebar__badge--success {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.35);
            color: #bbf7d0;
        }

        .runs-sidebar__badge--error {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.35);
            color: #fecaca;
        }

        .runs-sidebar__item-description {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .runs-sidebar__status {
            position: absolute;
            /* Make the loading indicator a small floating panel to avoid covering the list */
            top: 12px;
            right: 12px;
            left: auto;
            bottom: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.2;
            backdrop-filter: blur(6px);
            background: rgba(15, 23, 42, 0.85);
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.12);
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.6);
            opacity: 0;
            transition: opacity 0.18s ease, transform 0.18s ease;
            transform: translateY(-6px);
            pointer-events: none;
        }

        .runs-sidebar__status:not(.is-hidden) {
            opacity: 1;
            transform: translateY(0);
        }

        .runs-sidebar__error {
            color: #fecaca;
        }

        /* Mobile styling is opt-in; /agent defaults to desktop layout */
        @media (max-width: 1100px) {
            body.agent-mobile-enabled .page-shell {
                grid-template-columns: minmax(0, 1fr);
                gap: clamp(20px, 4vw, 32px);
                padding-left: clamp(16px, 4vw, 32px);
                min-height: auto;
            }

            body.agent-mobile-enabled .runs-sidebar {
                order: -1;
                height: auto;
                width: auto;
                border-radius: 24px;
                padding: clamp(18px, 5vw, 24px);
            }

            body.agent-mobile-enabled .runs-sidebar__resizer {
                display: none;
            }

            body.agent-mobile-enabled .container {
                border-radius: 24px;
                border-left: 1px solid var(--surface-border);
                padding: clamp(24px, 4vw, 48px);
            }
        }

        .top-nav {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
            color: var(--text-muted);
            gap: 14px;
        }

        .top-nav span {
            font-size: 0.95rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .top-nav-actions {
            display: inline-flex;
            align-items: center;
            justify-content: flex-end;
            flex-wrap: wrap;
            gap: 14px;
        }

        .top-nav-floating {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 14px;
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: rgba(15, 23, 42, 0.78);
            box-shadow: 0 28px 48px rgba(15, 23, 42, 0.55);
            backdrop-filter: blur(18px);
            z-index: 0;
        }

        .top-nav-floating::before {
            content: "";
            position: absolute;
            inset: -20px -24px;
            border-radius: 999px;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.4) 0%, rgba(15, 23, 42, 0) 65%);
            z-index: -1;
            opacity: 0.65;
            filter: blur(6px);
            pointer-events: none;
        }

        .top-nav-links,
        .top-nav-utility {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            flex-wrap: nowrap;
        }

        .top-nav-links .store-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border-radius: 9px;
            overflow: hidden;
            line-height: 0;
            border: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            height: clamp(40px, 6vw, 52px);
            background: rgba(15, 23, 42, 0.78);
            box-shadow: 0 18px 28px rgba(15, 23, 42, 0.45);
        }

        #googlePlayBadge {
            height: clamp(44px, 6vw, 56px);
        }

        #appStoreBadge {
            height: clamp(34px, 4.5vw, 40px);
        }

        .top-nav-links .store-badge img {
            display: block;
            height: 100%;
            width: auto;
        }

        .top-nav-links .store-badge.disabled {
            opacity: 0.7;
            pointer-events: none;
            box-shadow: none;
        }

        .top-nav-links .store-badge.disabled::after {
            content: 'Soon';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-18deg);
            background: linear-gradient(135deg, #a855f7, #ec4899);
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.86rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            pointer-events: none;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.45), 0 0 0 2px rgba(236, 72, 153, 0.15);
            white-space: nowrap;
        }

        .top-nav-links .store-badge:hover,
        .top-nav-links .store-badge:focus-visible {
            transform: translateY(-1px);
            box-shadow: 0 20px 32px rgba(15, 23, 42, 0.6);
        }

        .top-nav-links .store-badge:focus-visible {
            outline: 2px solid #a855f7;
            outline-offset: 2px;
        }

        .top-nav-links .store-badge.disabled:hover,
        .top-nav-links .store-badge.disabled:focus-visible {
            transform: none;
            box-shadow: none;
            outline: none;
        }

        h1 {
            margin: 0 0 16px;
            font-size: clamp(1.8rem, 2.4vw, 2.5rem);
            font-weight: 600;
            color: #f8fafc;
        }

        p.description {
            margin: 0;
            color: var(--text-muted);
            line-height: 1.65;
            font-size: 1rem;
        }

        form {
            display: grid;
            gap: 18px;
            margin-top: 28px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #f1f5f9;
            letter-spacing: 0.02em;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: 14px;
            border: 1px solid var(--surface-border);
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
        }

        input[type="text"]::placeholder {
            color: rgba(148, 163, 184, 0.7);
        }

        input[type="text"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.25);
            transform: translateY(-1px);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            line-height: 1.55;
        }

        #prompt {
            min-height: 140px;
            line-height: 1.5;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .python-test {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .python-test-result {
            font-size: 0.95rem;
            color: var(--text-muted);
            min-height: 1.2em;
        }

        .python-test-result.success {
            color: #4ade80;
        }

        .python-test-result.error {
            color: #fca5a5;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 999px;
            padding: 13px 28px;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-strong) 100%);
            color: white;
            box-shadow: 0 16px 32px rgba(124, 58, 237, 0.35);
            transition: transform 0.18s ease, box-shadow 0.18s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 24px 40px rgba(124, 58, 237, 0.38);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-muted);
            border: 1px solid var(--surface-border);
            box-shadow: none;
        }

        /* Run button: arrow submit like Aurora */
        .run-submit {
            padding: 10px;
            width: 48px;
            height: 48px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-strong) 100%);
            color: white;
            box-shadow: 0 16px 32px rgba(124, 58, 237, 0.35);
            border: none;
        }
        .run-submit svg { width: 22px; height: 22px; }
        .run-submit .run-icon-stop { display: none; }
        .run-submit .run-icon-send { display: inline-block; }
        #runButton.is-cancel .run-icon-stop { display: inline-block; }
        #runButton.is-cancel .run-icon-send { display: none; }
        .run-submit:hover { transform: translateY(-2px); }
        /* position run button to the right of controls */
        .actions { display: flex; align-items: center; gap: 12px; }
        #runButton { margin-left: auto; }

        button.secondary:hover {
            background: rgba(15, 23, 42, 0.85);
            color: var(--text-color);
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            height: 40px;
            padding: 0 20px;
            border-radius: 999px;
            font-weight: 600;
            letter-spacing: 0.02em;
            line-height: 1;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.85) 0%, rgba(139, 92, 246, 0.95) 100%);
            color: white;
            text-decoration: none;
            box-shadow: 0 18px 32px rgba(124, 58, 237, 0.35);
            transition: transform 0.18s ease, box-shadow 0.18s ease, opacity 0.2s ease;
        }

        .nav-button.icon-only {
            width: 40px;
            min-width: 40px;
            height: 40px;
            padding: 0;
            justify-content: center;
            gap: 0;
            border: 1px solid rgba(167, 139, 250, 0.45);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.32) 0%, rgba(79, 70, 229, 0.5) 100%);
            box-shadow: 0 18px 36px rgba(76, 29, 149, 0.35);
        }

        .nav-button.icon-tone {
            border: 1px solid rgba(167, 139, 250, 0.45);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.32) 0%, rgba(79, 70, 229, 0.5) 100%);
            box-shadow: 0 18px 36px rgba(76, 29, 149, 0.35);
        }

        .nav-button.icon-only.same-height {
            width: 40px;
            min-width: 40px;
            height: 40px;
            padding: 0;
        }

        .nav-button.icon-only svg,
        .nav-button.icon-only .icon {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-button.icon-only .icon {
            font-size: 1.35rem;
            line-height: 1;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 24px 40px rgba(124, 58, 237, 0.4);
            opacity: 0.9;
            color: white;
        }

        .nav-button:focus-visible {
            outline: 2px solid rgba(124, 58, 237, 0.8);
            outline-offset: 2px;
        }

        .status {
            margin-top: 28px;
            padding: 18px 22px;
            border-radius: 14px;
            background: rgba(124, 58, 237, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.28);
            color: #ede9fe;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #followupSessions {
            margin-top: 32px;
        }

        .followup-session + .followup-session {
            margin-top: 28px;
        }

        .followup-status {
            margin: 0 0 12px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .followup-status.followup-status--running {
            color: var(--accent-strong);
        }

        .followup-status.followup-status--complete {
            color: #4ade80;
        }

        .followup-status.followup-status--error {
            color: #fca5a5;
        }

        .followup-status.followup-status--canceled {
            color: #fcd34d;
        }

        .prompt-preview {
            margin-top: 16px;
            cursor: pointer;
            transition: background 0.18s ease, border-color 0.18s ease, transform 0.18s ease;
            text-align: left;
        }

        .prompt-preview:hover,
        .prompt-preview:focus-visible {
            background: rgba(124, 58, 237, 0.22);
            border-color: rgba(124, 58, 237, 0.45);
            transform: translateY(-1px);
            outline: none;
        }

        .prompt-preview:active {
            transform: translateY(0);
        }

        .prompt-preview[aria-hidden="true"] {
            display: none !important;
        }

        .prompt-preview-text {
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .prompt-preview-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            color: rgba(226, 232, 240, 0.75);
        }

        .status-text {
            display: inline-block;
        }

        .status-text.status-text-running {
            font-weight: 700;
            color: #00f5ff;
            background-image: linear-gradient(120deg, #00f5ff 0%, #00eaff 25%, #8ffeff 50%, #00eaff 75%, #00f5ff 100%);
            background-size: 260% 100%;
            background-repeat: no-repeat;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: statusRunningCyan 2.6s ease-in-out infinite;
            text-shadow: 0 2px 10px rgba(0, 245, 255, 0.16);
        }

        @keyframes statusRunningCyan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .status-idle {
            background: rgba(15, 23, 42, 0.55);
            border: 1px dashed var(--surface-border);
            color: var(--text-muted);
        }

        .status.error {
            background: rgba(249, 115, 22, 0.1);
            border-color: rgba(249, 115, 22, 0.35);
            color: #fed7aa;
        }

        .output-tabs {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }

        .tab-button {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 999px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            padding: 8px 18px;
            transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }

        .tab-button:hover,
        .tab-button:focus-visible {
            background: rgba(15, 23, 42, 0.65);
            color: var(--text-color);
            outline: none;
        }

        .tab-button.active {
            background: rgba(124, 58, 237, 0.18);
            border-color: rgba(124, 58, 237, 0.35);
            color: #ede9fe;
        }

        .log-output {
            background: rgba(2, 6, 23, 0.85);
            border: 1px solid var(--surface-strong-border);
            border-radius: 18px;
            padding: 22px;
            margin-top: 28px;
            white-space: pre-wrap;
            max-height: 520px;
            overflow-y: auto;
            font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, monospace;
            font-size: 0.95rem;
            line-height: 1.55;
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.15);
        }

        .is-hidden {
            display: none !important;
        }

        .log-line {
            display: block;
            margin-bottom: 6px;
        }

        .log-line.stderr {
            color: #4dd0e1;
        }

        .log-line.status {
            color: #c4b5fd;
        }

        .log-line.meta {
            color: #67e8f9;
        }

        .codex-hide-meta .log-output .log-line.meta {
            display: none;
        }

        .meta {
            margin-top: 32px;
            color: var(--text-muted);
            font-size: 0.95rem;
            display: grid;
            gap: 8px;
            border-top: 1px solid rgba(148, 163, 184, 0.15);
            padding-top: 20px;
        }

        .meta code {
            background: rgba(15, 23, 42, 0.7);
            padding: 4px 8px;
            border-radius: 8px;
            color: #f8fafc;
            border: 1px solid rgba(148, 163, 184, 0.25);
        }

        .default-model {
            margin-bottom: 24px;
            padding: 16px 20px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.04);
            border: 1px solid rgba(148, 163, 184, 0.25);
        }

        .default-model h2 {
            margin: 0 0 8px 0;
            font-size: 1.1rem;
            color: #0f172a;
        }

        .default-model p {
            margin: 0 0 14px 0;
            color: #64748b;
            font-size: 0.95rem;
        }

        .default-model-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .default-model-controls input[type="text"] {
            flex: 1;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: rgba(15, 23, 42, 0.03);
            font-size: 0.95rem;
            color: #0f172a;
        }

        .default-model-controls input[type="text"]:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
            background: #fff;
        }

        .default-model-feedback {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #0f172a;
        }

        .default-model-feedback.error {
            color: #b91c1c;
        }

        .default-model-feedback.success {
            color: #047857;
        }

        .default-model-feedback.hidden {
            display: none;
        }

        .agent-instructions-actions {
            margin-top: 12px;
            display: flex;
            gap: 12px;
        }

        .agent-instructions-feedback {
            margin-top: 10px;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .agent-instructions-feedback.success {
            color: #047857;
        }

        .agent-instructions-feedback.error {
            color: #b91c1c;
        }

        .agent-instructions-feedback.hidden {
            display: none;
        }

        .file-tree-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .file-tree-header label {
            margin-bottom: 0;
        }

        .file-tree-toggle {
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid var(--surface-border);
            background: rgba(15, 23, 42, 0.55);
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: none;
            flex-shrink: 0;
            transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .file-tree-toggle:hover,
        .file-tree-toggle:focus-visible {
            background: rgba(15, 23, 42, 0.75);
            color: var(--text-color);
            outline: none;
        }

        .file-tree-toggle:focus-visible {
            outline: 2px solid rgba(124, 58, 237, 0.6);
            outline-offset: 2px;
        }

        .file-tree-toggle.is-active {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.9) 0%, rgba(139, 92, 246, 0.95) 100%);
            color: #f8fafc;
            border-color: transparent;
            box-shadow: 0 18px 32px rgba(124, 58, 237, 0.35);
        }

        .file-tree-toggle.is-active:hover,
        .file-tree-toggle.is-active:focus-visible {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.95) 0%, rgba(124, 58, 237, 0.95) 100%);
            color: #f8fafc;
        }

        .file-tree-container textarea {
            min-height: 220px;
            font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, monospace;
            line-height: 1.5;
            white-space: pre;
            overflow: auto;
            resize: vertical;
        }

        .file-tree-container textarea[readonly] {
            background: rgba(2, 6, 23, 0.75);
            border-color: rgba(148, 163, 184, 0.35);
        }

        .file-tree-status {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .file-tree-status.error {
            color: #fda4af;
        }

        .file-tree-status.success {
            color: #34d399;
        }

        .file-tree-status.muted {
            color: rgba(148, 163, 184, 0.7);
        }

        @media (max-width: 720px) {
            body.agent-mobile-enabled {
                padding: 16px;
            }

            body.agent-mobile-enabled .container {
                padding: 24px 20px;
            }

            body.agent-mobile-enabled .top-nav {
                flex-direction: column;
                align-items: flex-start;
            }

            body.agent-mobile-enabled .top-nav-actions {
                width: 100%;
                justify-content: space-between;
            }

            body.agent-mobile-enabled .nav-button {
                width: auto;
            }

            body.agent-mobile-enabled .file-tree-header {
                flex-direction: column;
                align-items: flex-start;
            }

            body.agent-mobile-enabled .file-tree-toggle {
                width: 100%;
            }

            body.agent-mobile-enabled .default-model-controls {
                flex-direction: column;
                align-items: stretch;
            }

            body.agent-mobile-enabled .actions {
                flex-direction: column;
                align-items: stretch;
            }

            body.agent-mobile-enabled button,
            body.agent-mobile-enabled button.secondary {
                width: 100%;
                text-align: center;
            }
        }
    
        
        /* Git Log modal removed */
        /* no-op */
        #gitLogModal,
        #gitTreeModal {
            position: fixed;
            inset: 0;
            z-index: 10000;
        }
        #gitLogModal .modal-content,
        #gitTreeModal .modal-content {
            /* removed */

            max-height: 100vh !important;
            border-radius: 0 !important;
        }
        .modal-overlay {

            position: fixed;
            inset: 0;
            background: rgba(2,6,23,0.6);
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            z-index: 10000;
            padding: 0; /* remove extra margin so modal can fill viewport */
            box-sizing: border-box;
        }
        .modal-overlay.is-hidden { display: none; }
        .modal-content {
            width: 100%;
            max-width: 100%;
            max-height: 100vh;
            height: 100vh;
            border-radius: 8px; /* small radius to keep subtle rounding */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, var(--surface) 0%, var(--bg-main) 100%);
            box-shadow: 0 24px 80px rgba(2,6,23,0.7);
            border: 1px solid var(--surface-border);
            margin: 0; /* ensure no extra margin */
        }
        .modal-iframe {
            width: 100%;
            height: 100%;
            flex: 1 1 auto;
            border: 0;
            display: block;
            background: white;
        }
        .modal-iframe.is-loading {
            opacity: 0;
            pointer-events: none;
        }

        .usage-limit-modal .modal-content {
            max-width: 640px;
            width: 92%;
            height: auto;
            max-height: 90vh;
            margin: auto;
            padding: 28px 28px 24px;
            border-radius: 20px;
            overflow: auto;
            position: relative;
        }

        .usage-limit-modal .usage-limit-message {
            margin: 4px 0 16px;
            color: rgba(226, 232, 240, 0.9);
        }

        .auth-modal .modal-content {
            max-width: 520px;
            width: 92%;
            height: auto;
            max-height: 90vh;
            margin: auto;
            padding: 28px 28px 24px;
            border-radius: 20px;
            overflow: auto;
            position: relative;
        }

        .modal-content--auth .modal-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .modal-content--auth .auth-benefits {
            background: rgba(15, 23, 42, 0.45);
            border: 1px solid var(--surface-border);
            border-radius: 14px;
            padding: 12px 14px;
            margin-bottom: 18px;
        }

        .modal-content--auth .auth-benefits p {
            margin: 0 0 8px;
            font-weight: 600;
        }

        .modal-content--auth .auth-benefits ul {
            margin: 0;
            padding-left: 20px;
        }

        .modal-content--auth .auth-benefits li + li {
            margin-top: 4px;
        }

        .modal-content--auth .auth-email-label {
            display: block;
        }

        .auth-modal .modal-close {
            top: 10px;
            right: 10px;
        }

        #switchBranchModal {
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        #switchBranchModal .modal-content {
            max-width: 520px;
            width: 92%;
            height: auto;
            max-height: 90vh;
            margin: auto;
            padding: 26px 28px 24px;
            border-radius: 20px;
            overflow: auto;
            position: relative;
        }

        #switchBranchModal h2 {
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 1.2rem;
        }

        #switchBranchModal .switch-branch-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        #switchBranchModal .switch-branch-create {
            background: transparent;
            border: none;
            color: var(--accent);
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            text-decoration: underline;
            transform: translateX(-70px);
        }

        #switchBranchModal .switch-branch-create:hover,
        #switchBranchModal .switch-branch-create:focus-visible {
            color: var(--accent-strong);
        }

        #switchBranchModal label {
            font-size: 0.92rem;
            color: var(--text-muted);
        }

        #switchBranchModal select,
        #switchBranchModal input[type="text"] {
            width: 100%;
            margin-top: 8px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--surface-border);
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-color);
            font-size: 0.95rem;
        }

        #switchBranchModal select:focus,
        #switchBranchModal input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.25);
        }

        #switchBranchModal .switch-branch-actions {
            margin-top: 18px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        #switchBranchModal .switch-branch-message {
            margin-top: 12px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .auth-modal label {
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }

        .account-modal .account-details {
            margin: 16px 0 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 10px;
        }

        .account-modal .account-details li {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--surface-border);
        }

        .account-modal .account-details span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .account-modal .account-details strong {
            font-weight: 600;
        }

        .auth-modal input[type="email"],
        .auth-modal input[type="password"],
        .auth-modal input[type="text"] {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--surface-border);
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-color);
            font-size: 0.95rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .auth-modal input[type="email"]:focus,
        .auth-modal input[type="password"]:focus,
        .auth-modal input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.25);
        }

        .modal-buttons {
            margin-top: 1rem;
            text-align: right;
        }

        .modal-buttons button {
            background: rgba(30, 41, 59, 0.92);
            border: 1px solid var(--surface-border);
            color: var(--text-color);
            margin-left: 4px;
            cursor: pointer;
            border-radius: 10px;
            padding: 0.45rem 0.75rem;
            transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
        }

        .modal-buttons button:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .modal-buttons button.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: #f8fafc;
        }

        .modal-buttons button.primary:hover {
            background: var(--accent-strong);
            border-color: var(--accent-strong);
        }

        .password-requirements__check {
            position: relative;
            padding-left: 24px;
            margin: 6px 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .password-requirements__check::before {
            content: "";
            position: absolute;
            left: 0;
            top: 3px;
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 1px solid var(--surface-border);
            background: rgba(15, 23, 42, 0.65);
        }

        .password-requirements__check::after {
            content: "";
            position: absolute;
            left: 4px;
            top: 7px;
            width: 6px;
            height: 3px;
            border-left: 2px solid transparent;
            border-bottom: 2px solid transparent;
            transform: rotate(-45deg);
            opacity: 0;
        }

        .password-requirements__check.is-met::before {
            background: rgba(124, 58, 237, 0.7);
            border-color: rgba(124, 58, 237, 0.9);
        }

        .password-requirements__check.is-met::after {
            border-left-color: #f8fafc;
            border-bottom-color: #f8fafc;
            opacity: 1;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(124, 58, 237, 0.92);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10001;
        }

        .toast.show {
            display: block;
            opacity: 1;
        }

        .view-tab {
            background: var(--surface);
            color: var(--text-color);
            border: 1px solid var(--surface-border);
            padding: 0.45rem 0.85rem;
            cursor: pointer;
            border-radius: 999px;
            transition: background 0.2s ease, border-color 0.2s ease;
        }

        .view-tab.active {
            background: var(--accent-light);
            border-color: var(--accent);
            color: var(--accent);
        }

        .password-requirements {
            margin-top: 12px;
            padding: 16px 18px;
            border-radius: 16px;
            background: var(--surface);
            border: 1px solid var(--surface-border);
            color: var(--text-color);
        }

        .password-requirements__title {
            margin: 0;
            font-weight: 600;
            color: var(--text-color);
        }

        .password-requirements__subtitle {
            margin: 8px 0 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .password-requirements__list {
            margin: 12px 0 0;
            padding: 0;
            list-style: none;
        }

        .password-requirements__item {
            position: relative;
            padding-left: 24px;
            font-size: 0.95rem;
            line-height: 1.4;
            color: var(--text-color);
        }

        .password-requirements__item + .password-requirements__item {
            margin-top: 6px;
        }

        .password-requirements__item::before {
            content: "";
            position: absolute;
            left: 0;
            top: 8px;
            width: 10px;
            height: 10px;
            border: 2px solid var(--accent);
            border-radius: 50%;
        }
        /* Git Log modal loader */
        .git-log-loader {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2,6,23,0.56);
            z-index: 1001;
        }
        .git-log-loader.is-hidden { display: none; }
        .git-log-loader .loading-spinner {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.12);
            border-top-color: #9ad3ff;
            animation: spin 0.9s linear infinite;
        }

        .git-log-loader .loading-card {
            min-width: 260px;
            max-width: min(90vw, 420px);
            padding: 18px 22px;
            border-radius: 12px;
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.92), rgba(30, 41, 59, 0.78));
            border: 1px solid rgba(148, 163, 184, 0.12);
            box-shadow: var(--shadow-elevated);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .git-log-loader .loading-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #f8fafc;
        }

        .git-log-loader .loading-log {
            margin: 0;
            padding: 8px;
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.8);
            font-family: "JetBrains Mono", "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
            font-size: 0.78rem;
            line-height: 1.4;
            color: var(--text-muted);
            border: 1px solid rgba(148, 163, 184, 0.12);
            text-align: left;
            white-space: pre-line;
        }

        /* Repo add modal loader */
        .repo-add-loader {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2,6,23,0.56);
            z-index: 1001;
        }

        .repo-add-loader.is-hidden { display: none; }

        .repo-add-loader .loading-spinner {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.12);
            border-top-color: #9ad3ff;
            animation: spin 0.9s linear infinite;
        }

        .repo-add-loader .loading-card {
            min-width: 260px;
            max-width: min(90vw, 420px);
            padding: 18px 22px;
            border-radius: 12px;
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.92), rgba(30, 41, 59, 0.78));
            border: 1px solid rgba(148, 163, 184, 0.12);
            box-shadow: var(--shadow-elevated);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .repo-add-loader .loading-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #f8fafc;
        }

        /* Settings modal loader */
        .settings-modal-loader {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2,6,23,0.56);
            z-index: 1001;
        }

        .settings-modal-loader.is-hidden { display: none; }

        .settings-modal-loader .loading-spinner {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.12);
            border-top-color: #9ad3ff;
            animation: spin 0.9s linear infinite;
        }

        .settings-modal-loader .loading-card {
            min-width: 260px;
            max-width: min(90vw, 420px);
            padding: 18px 22px;
            border-radius: 12px;
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.92), rgba(30, 41, 59, 0.78));
            border: 1px solid rgba(148, 163, 184, 0.12);
            box-shadow: var(--shadow-elevated);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .settings-modal-loader .loading-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #f8fafc;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        .prompt-modal-content {
            max-width: min(900px, 92vw);
            height: auto;
            max-height: min(720px, 92vh);
            margin: auto;
        }

        .prompt-modal-body {
            display: flex;
            flex-direction: column;
            gap: 18px;
            padding: 32px;
            flex: 1;
        }

        .prompt-modal-body textarea {
            flex: 1;
            width: 100%;
            border-radius: 16px;
            border: 1px solid var(--surface-border);
            background: rgba(2, 6, 23, 0.85);
            color: var(--text-color);
            font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            padding: 18px 20px;
            resize: none;
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.12);
        }

        .prompt-modal-body textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.28);
        }
        .modal-close {
            position: absolute;
            right: 12px;
            top: 12px;
            z-index: 10001;
            background: rgba(15,23,42,0.6);
            border-radius: 999px;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        #sterlingSettingsBtn,
        #helpGuideButton {
            background: rgba(124, 58, 237, 0.18);
            border: 1px solid rgba(124, 58, 237, 0.45);
            color: #c4b5fd;
        }

        #sterlingSettingsBtn:hover,
        #sterlingSettingsBtn:focus-visible,
        #helpGuideButton:hover,
        #helpGuideButton:focus-visible {
            background: rgba(124, 58, 237, 0.28);
            border-color: rgba(167, 139, 250, 0.7);
            color: #f5f3ff;
        }

        #sterlingSettingsCloseButton {
            background: rgba(124, 58, 237, 0.28);
            border: 1px solid rgba(167, 139, 250, 0.7);
            color: #f8fafc;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.35);
        }

        #sterlingSettingsCloseButton:hover,
        #sterlingSettingsCloseButton:focus-visible {
            background: rgba(124, 58, 237, 0.4);
            border-color: rgba(196, 181, 253, 0.85);
        }

        #helpGuideCloseButton {
            background: rgba(124, 58, 237, 0.28);
            border: 1px solid rgba(167, 139, 250, 0.7);
            color: #f8fafc;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.35);
        }

        #helpGuideCloseButton:hover,
        #helpGuideCloseButton:focus-visible {
            background: rgba(124, 58, 237, 0.4);
            border-color: rgba(196, 181, 253, 0.85);
        }

        #aboutModalCloseButton {
            background: rgba(124, 58, 237, 0.28);
            border: 1px solid rgba(167, 139, 250, 0.7);
            color: #f8fafc;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.35);
        }

        #aboutModalCloseButton:hover,
        #aboutModalCloseButton:focus-visible {
            background: rgba(124, 58, 237, 0.4);
            border-color: rgba(196, 181, 253, 0.85);
        }

        #repoAddCloseButton {
            background: rgba(124, 58, 237, 0.28);
            border: 1px solid rgba(167, 139, 250, 0.7);
            color: #f8fafc;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.35);
        }

        #repoAddCloseButton:hover,
        #repoAddCloseButton:focus-visible {
            background: rgba(124, 58, 237, 0.4);
            border-color: rgba(196, 181, 253, 0.85);
        }

        #aboutModal .modal-content {
            max-width: 980px;
            width: 90%;
            margin: auto;
            position: relative;
        }

        #repoAddModal .modal-content {
            max-width: 980px;
            width: 90%;
            margin: auto;
            position: relative;
        }

        #gitLogModal .modal-close {
            background: #dc2626;
            color: #fff;
            box-shadow: 0 0 0 1px rgba(220, 38, 38, 0.45);
            border: 1px solid rgba(185, 28, 28, 0.8);
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
/* Custom Run/Cancel and Merge styles */
        /* Run button transforms into Cancel Run while controls are disabled (visual only) */
        #runButton.is-cancel {
            background: rgba(245, 101, 101, 0.12); /* faint red */
            color: #ffdede;
            border: 1px solid rgba(245, 101, 101, 0.18);
            box-shadow: none;
        }
        #runButton.is-cancel:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(245, 101, 101, 0.06);
        }

        /* Merge button default: subtle grey-white */
        .merge-button-wrapper {
            position: relative;
            display: inline-flex;
        }
        .merge-button-wrapper .merge-disabled-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translate(-50%, 6px);
            padding: 8px 12px;
            background: rgba(15, 23, 42, 0.95);
            color: rgba(241, 245, 249, 0.95);
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.3;
            max-width: 260px;
            white-space: normal;
            text-align: center;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.18s ease, transform 0.18s ease;
            z-index: 5;
        }
        .merge-button-wrapper.is-merge-disabled:hover .merge-disabled-tooltip,
        .merge-button-wrapper.is-merge-disabled.is-tooltip-visible .merge-disabled-tooltip {
            opacity: 1;
            transform: translate(-50%, 0);
        }
        #mergeButton {
            background: rgba(255,255,255,0.03);
            color: rgba(230,230,230,0.9);
            border: 1px solid rgba(255,255,255,0.04);
            box-shadow: none;
            transition: background 0.18s ease, color 0.18s ease, box-shadow 0.18s ease, transform 0.12s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        #mergeButton svg { opacity: 0.9; }

        /* Merge button when ready: brighten to accent */
        #mergeButton.is-merge-ready {
            background: linear-gradient(135deg, rgba(124,58,237,0.92) 0%, rgba(139,92,246,0.98) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 18px 32px rgba(124, 58, 237, 0.28);
        }


        /* Archived toggle active style */
        #runsSidebar .runs-sidebar__icon-button[aria-pressed="true"] {
            background: linear-gradient(135deg, rgba(124,58,237,0.95) 0%, rgba(139,92,246,0.98) 100%) !important;
            color: #fff !important;
            border-color: rgba(124,58,237,0.95) !important;
            box-shadow: 0 12px 28px rgba(124,58,237,0.28) !important;
        }


        .runs-sidebar__back-link {
            display: inline-block;
            margin-top: 10px;
            color: #fff;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            padding-left: 6px;
        }
        .runs-sidebar__back-link.is-hidden { display: none; }


        /* Repositories dropdown */
        .repos-dropdown { position: absolute; display: none; z-index: 4000; }
        .repos-dropdown.is-visible { display: block; }
        .repos-dropdown__inner { width: 420px; height: 360px; background: linear-gradient(180deg, rgba(6,8,15,0.98), rgba(12,16,28,0.95)); border:1px solid rgba(255,255,255,0.04); box-shadow: 0 12px 40px rgba(2,6,23,0.6); border-radius: 12px; overflow: hidden; }
        .repos-dropdown__inner iframe { width: 100%; height: 100%; border: none; }

    
        /* Tooltip for Branch button */
        #branchComingSoonTooltip {
            transition: opacity 0.18s ease;
            position: absolute;
            display: inline-block;
            white-space: normal;
            text-align: center;
        }


        /* Runs sidebar collapse/expand controls */
        .runs-sidebar__toggle {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1400;
        }
        .expand-runs-sidebar-arrow {
            position: relative;
            width: 38px;
            height: 38px;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: linear-gradient(135deg, rgba(124,58,237,0.18), rgba(15,23,42,0.85));
            color: var(--text-color);
            box-shadow: 0 12px 28px rgba(2,6,23,0.5);
            cursor: pointer;
            font-weight: 700;
            border: 1px solid rgba(148,163,184,0.12);
        }
        .runs-sidebar__collapse {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 38px;
            height: 38px;
            padding: 6px;
            border-radius: 8px;
            background: rgba(124,58,237,0.12);
            color: var(--text-color);
            border: 1px solid rgba(148,163,184,0.06);
            cursor: pointer;
            margin-left: 0;
        }
        .runs-sidebar-collapsed #runsSidebarResizer { display: none !important; }
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__header,
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__title-group,
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__actions,
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__primary-action,
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__body,
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__pagination { display: none !important; }
        .runs-sidebar-collapsed .expand-runs-sidebar-arrow { display: flex !important; }
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__collapsed-mini { display: flex; }
        .runs-sidebar-collapsed .runs-sidebar__collapse { display: none !important; }
        /* Hide footer links when collapsed */
        .runs-sidebar-collapsed #runsSidebar .runs-sidebar__footer {
            display: none !important;
        }

    
        /* Collapsed mini New Task button */
        .runs-sidebar__collapsed-newtask {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            margin: 0;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95) 0%, rgba(139, 92, 246, 0.98) 100%);
            border: none;
            color: #fff;
            box-shadow: 0 12px 26px rgba(124, 58, 237, 0.28);
            font-weight: 700;
            cursor: pointer;
        }
        .runs-sidebar__collapsed-newtask:hover,
        .runs-sidebar__collapsed-newtask:focus-visible {
            transform: translateY(-1px);
            box-shadow: 0 16px 36px rgba(124, 58, 237, 0.32);
            outline: none;
        }
</style>
</head>
<body>
<% var iframeMode = typeof isIframeMode === "boolean" ? isIframeMode : true; %>
    <div class="agent-scale-container">
        <div class="page-shell">
        <aside id="runsSidebar" class="runs-sidebar" aria-labelledby="runsSidebarTitle">
            <div id="runsSidebarResizer" class="runs-sidebar__resizer" aria-hidden="true"></div>
            <div class="runs-sidebar__toggle">
                <button type="button" id="collapseRunsSidebarBtn" class="runs-sidebar__collapse" aria-label="Collapse sidebar"></button>
            </div>

            <div class="runs-sidebar__collapsed-mini" aria-label="Collapsed agent navigation">
                <button type="button" id="collapsedSidebarLogo" class="runs-sidebar__collapsed-logo" aria-label="Expand sidebar">
                    <img src="/alfe_favicon_chat_mountain_rect_purple_WHITEBG_64x64.png" alt="Alfe AI logo">
                </button>

                <button type="button" id="expandRunsSidebarArrow" class="expand-runs-sidebar-arrow" aria-label="Expand sidebar"></button>
                <div class="runs-sidebar__collapsed-nav" role="navigation" aria-label="Agent quick links">
                    <a href="javascript:void(0)" class="runs-sidebar__collapsed-nav-link" data-tab="code" aria-label="Code tab" onclick="if(event){event.preventDefault();}">
                        <span aria-hidden="true">&lt;/&gt;</span>
                    </a>
                    <a href="<%= chatBaseUrl %>" class="runs-sidebar__collapsed-nav-link" data-tab="chat" aria-label="Chat tab">
                        <span aria-hidden="true"></span>
                    </a>
                    <% if (showImageDesign2026) { %>
                    <a href="<%= chatDesignUrl %>" target="_blank" rel="noopener noreferrer" class="runs-sidebar__collapsed-nav-link" data-tab="design" aria-label="Image Design tab">
                        <span aria-hidden="true"></span>
                    </a>
                    <% } %>
                </div>
                <button type="button" id="collapsedNewTaskBtn" class="runs-sidebar__collapsed-newtask" aria-label="New Task" title="New Task">
                    <span aria-hidden="true">+</span>
                </button>
            </div>

            <div class="runs-sidebar__header">
                <div class="sidebar-brand">
                <div class="sidebar-header">
                    <div class="sidebar-brand-icon">
                        <a href="javascript:void(0)" class="sidebar-brand-icon-link" aria-label="Alfe AI" onclick="if(event){event.preventDefault();}">
                            <img src="/alfe_favicon_chat_mountain_rect_purple_WHITEBG_64x64.png" alt="Alfe AI logo">
                        </a>
                    </div>
        

                    <div class="sidebar-brand-text">
                        <h1 class="sidebar-brand-heading">
                            <% if (typeof environment !== 'undefined' && environment && environment !== 'unknown') { %>
                                <span class="environment-indicator <%= environment %>"><%= environment %>:</span>
                            <% } %>
                            <a href="javascript:void(0)" class="sidebar-brand-name" aria-label="Alfe AI" onclick="if(event){event.preventDefault();}">Alfe AI</a>
                        </h1>
                    </div>
                </div>
            </div>
            <div class="runs-sidebar__title-group">

                <nav class="sidebar-nav aurora-nav" aria-label="Agent primary tabs">
                    <a href="javascript:void(0)" class="sidebar-nav-item" data-tab="code" aria-label="Code tab" onclick="if(event){event.preventDefault();}">
                        <span class="sidebar-nav-item__icon" aria-hidden="true">&lt;/&gt;</span>
                        <span class="sidebar-nav-item__label">Code</span>
                    </a>
                    <a href="<%= chatBaseUrl %>" class="sidebar-nav-item" data-tab="chat" aria-label="Chat tab">
                        <span class="sidebar-nav-item__icon" aria-hidden="true"></span>
                        <span class="sidebar-nav-item__label">Chat</span>
                    </a>
                    <% if (showImageDesign2026) { %>
                    <a href="<%= chatDesignUrl %>" target="_blank" rel="noopener noreferrer" class="sidebar-nav-item" data-tab="design" aria-label="Image Design tab">
                        <span class="sidebar-nav-item__icon" aria-hidden="true"></span>
                        <span class="sidebar-nav-item__label">Image Design</span>
                    </a>
                    <% } %>
                </nav>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        try {
                            // Ensure Image Design link is visible
                            var designLink = document.querySelector('.sidebar-nav-item[data-tab="design"]');
                            if(designLink && <%= showImageDesign2026 ? 'true' : 'false' %>) { designLink.style.display = ''; }
                            // Hide any upload buttons/inputs in sidebar by default
                            var fileInput = document.getElementById('fileInput');
                            if(fileInput) fileInput.style.display = 'none';
                            var secureSubmit = document.getElementById('secureUploadSubmit');
                            if(secureSubmit) secureSubmit.style.display = 'none';
                            // Hide buttons that have text 'Upload'
                            document.querySelectorAll('#runsSidebarList button, #runsSidebarList input, .runs-sidebar__body button, .runs-sidebar__body input, .sidebar button, .sidebar input').forEach(function(el){
                                try {
                                    var txt = (el.innerText || el.value || '').trim().toLowerCase();
                                    if(txt === 'upload' || txt === 'upload & upscale' || txt === 'upload image'){
                                        el.style.display = 'none';
                                    }
                                } catch(e) {}
                            });
                        } catch (e) { /* no-op */ }
                    });
                </script>

                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        try {
                            var params = new URLSearchParams(window.location.search || "");
                            var activeTab = (params.get('tab') || 'code').toLowerCase();
                            var navLinks = document.querySelectorAll('.sidebar-nav-item, .runs-sidebar__collapsed-nav-link');
                            navLinks.forEach(function(link) {
                                var tabValue = (link.dataset && link.dataset.tab ? link.dataset.tab : '').toLowerCase();
                                var shouldActivate = (!activeTab && tabValue === 'code') || activeTab === tabValue;
                                link.classList.remove('is-active');
                                link.removeAttribute('aria-current');
                                if (shouldActivate) {
                                    link.classList.add('is-active');
                                    link.setAttribute('aria-current', 'page');
                                }
                            });
                        } catch (e) {
                            /* no-op */
                        }
                    });
                </script>
                    <div id="runsSidebarTitle" class="runs-sidebar__title"><div class="sidebar-version" style="margin:0; font-size:1.007rem; font-weight:600;">
                            <button
                                id="repoDropdownTrigger"
                                class="repo-trigger"
                                type="button"
                                aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="reposDropdown"
                            >
                                <span class="repo-caret" aria-hidden="true"></span>
                                <span class="repo-trigger__text">
                                    <span class="repo-label">Repository:</span>
                                    <span class="repo-name"><%= typeof repoName !== "undefined" && repoName ? repoName : "Select a repository" %></span>
                                    <span class="repo-demo-badge is-hidden">Demo</span>
                                </span>
                            </button>
                        </div>
                        </div>
                    <button
                        type="button"
                        id="projectInfo"
                        class="project-info"
                        aria-haspopup="dialog"
                        aria-expanded="false"
                        aria-controls="switchBranchModal"
                    >
                        <span id="projectInfoCaret" class="project-info__caret" aria-hidden="true"></span>
                        <span id="projectInfoText" class="project-info__text">Branch</span>
                    </button>
                </div>
                <div id="reposDropdown" class="repos-dropdown is-hidden" aria-hidden="true">
                    <div class="repos-dropdown__inner">
                        <iframe id="reposDropdownIframe" src="/repositories" frameborder="0" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" ></iframe>
                    </div>
                </div>
                <div id="branchesDropdown" class="repos-dropdown is-hidden" aria-hidden="true">
                    <div class="repos-dropdown__inner">
                        <iframe id="branchesDropdownIframe" src="/agent/git-tree" frameborder="0" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
                    </div>
                </div>
                <div class="runs-sidebar__actions">
<button type="button" id="backlogButton" class="runs-sidebar__icon-button" aria-label="Backlog" title="Backlog" onclick="window.open(window.location.origin + '/ProjectView/', '_blank')">Backlog</button>
<button type="button" id="runsSidebarOpenRunsButton" class="runs-sidebar__icon-button is-hidden" aria-label="Detail run" title="Detail run">
                        Detail
                    </button>
<button type="button" id="runsSidebarArchiveToggle" class="runs-sidebar__icon-button" aria-pressed="false" aria-label="Archived" title="Archived">Archived</button>

                </div>
            </div>


            <div class="runs-sidebar__primary-action">
                <% if (showNewTaskButton) { %><button type="button" id="runsSidebarNewTaskButton" class="runs-sidebar__new-task">
                    <span class="runs-sidebar__new-task-icon" aria-hidden="true">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>
                    <span class="runs-sidebar__new-task-label">New Task</span>
                </button>
                <% } %>
                <button type="button" id="backToCurrentTasksLink" class="runs-sidebar__back-link is-hidden" aria-hidden="true">&lt;-- Back to Current Tasks</button>

            </div>
            <div class="runs-sidebar__body">
                <div id="runsSidebarLoading" class="runs-sidebar__status runs-sidebar__loading is-hidden" role="status" aria-live="polite"></div>
                <div id="runsSidebarError" class="runs-sidebar__status runs-sidebar__error is-hidden" role="alert"></div>
                <div id="runsSidebarEmpty" class="runs-sidebar__status runs-sidebar__empty is-hidden">No runs recorded yet.</div>
                <div id="runsSidebarList" class="runs-sidebar__list" role="list" aria-labelledby="runsSidebarTitle"></div>
            </div>
            <div id="runsSidebarPagination" class="runs-sidebar__pagination is-hidden" aria-live="polite">
                <button type="button" id="runsSidebarPrevPage" class="runs-sidebar__pagination-button" aria-label="Previous runs page">Previous</button>
                <div class="runs-sidebar__pagination-center">
                    <div id="runsSidebarPageIndicator" class="runs-sidebar__pagination-indicator" role="status">Page 1 of 1</div>
                    <button type="button" id="runsSidebarArchiveAllButton" class="runs-sidebar__archive-all-button" aria-label="Archive all runs" title="Archive all runs">Archive All</button>
                </div>
                <button type="button" id="runsSidebarNextPage" class="runs-sidebar__pagination-button" aria-label="Next runs page">Next</button>
            </div>
            <footer class="runs-sidebar__footer">
                <div class="runs-sidebar__footer-links">
                    <button type="button" id="aboutModalButton" class="github-link-button">About</button>
                    <button
                        type="button"
                        class="github-link-button"
                        onclick="window.open('https://github.com/alfe-ai', '_blank', 'noopener,noreferrer');"
                        oncontextmenu="window.open('https://github.com/alfe-ai', '_blank', 'noopener,noreferrer'); return false;"
                    >
                        GitHub
                        <span aria-hidden="true" class="github-link-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" focusable="false">
                                <g weight="bold">
                                    <path d="M212.62,75.17A63.7,63.7,0,0,0,206.39,26,12,12,0,0,0,196,20a63.71,63.71,0,0,0-50,24H126A63.71,63.71,0,0,0,76,20a12,12,0,0,0-10.39,6,63.7,63.7,0,0,0-6.23,49.17A61.5,61.5,0,0,0,52,104v8a60.1,60.1,0,0,0,45.76,58.28A43.66,43.66,0,0,0,92,192v4H76a20,20,0,0,1-20-20,44.05,44.05,0,0,0-44-44,12,12,0,0,0,0,24,20,20,0,0,1,20,20,44.05,44.05,0,0,0,44,44H92v12a12,12,0,0,0,24,0V192a20,20,0,0,1,40,0v40a12,12,0,0,0,24,0V192a43.66,43.66,0,0,0-5.76-21.72A60.1,60.1,0,0,0,220,112v-8A61.5,61.5,0,0,0,212.62,75.17ZM196,112a36,36,0,0,1-36,36H112a36,36,0,0,1-36-36v-8a37.87,37.87,0,0,1,6.13-20.12,11.65,11.65,0,0,0,1.58-11.49,39.9,39.9,0,0,1-.4-27.72,39.87,39.87,0,0,1,26.41,17.8A12,12,0,0,0,119.82,68h32.35a12,12,0,0,0,10.11-5.53,39.84,39.84,0,0,1,26.41-17.8,39.9,39.9,0,0,1-.4,27.72,12,12,0,0,0,1.61,11.53A37.85,37.85,0,0,1,196,104Z"></path>
                                </g>
                            </svg>
                        </span>
                    </button>
                </div>
            </footer>
        </aside>
        <div class="container">

        <div class="top-nav">
            <div class="top-nav-actions">
                <div class="top-nav-floating">
                    <div class="top-nav-links">
                        <% if (!iframeMode) { %>
                        <button
                            id="refreshRunsButton"
                            type="button"
                            class="nav-button secondary icon-only is-hidden"
                            title="Refresh runs (repo only)"
                            aria-label="Refresh runs (repo only)"
                            onclick="(function(){const input=document.getElementById('projectDir');const dir=(input && input.value && input.value.trim())?input.value.trim():(new URLSearchParams(window.location.search).get('repo_directory')||'');const url='/environment'+(dir?('?repo_directory='+encodeURIComponent(dir)):'');window.location.href=url;})();"
                        >
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M21 12a9 9 0 10-3.22 6.53" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 3v6h-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <span class="sr-only">Refresh runs</span>
                        </button>
                        <% } %>

                        <% if (showStoreButtons) { %>
                        <a
                            id="googlePlayBadge"
                            class="store-badge disabled"
                            href="https://play.google.com/store/apps/details?id=ai.alfe.aurora"
                            data-default-href="https://play.google.com/store/apps/details?id=ai.alfe.aurora"
                            target="_blank"
                            rel="noopener noreferrer"
                            aria-label="Get the Aurora app on Google Play (coming soon)"
                            aria-disabled="true"
                        >
                            <img src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png" alt="Get it on Google Play" loading="lazy" />
                        </a>
                        <a
                            id="appStoreBadge"
                            class="store-badge disabled"
                            href="https://apps.apple.com/app/id6504207150"
                            data-default-href="https://apps.apple.com/app/id6504207150"
                            target="_blank"
                            rel="noopener noreferrer"
                            aria-label="Download the Aurora app on the App Store (coming soon)"
                            aria-disabled="true"
                        >
                            <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="Download on the App Store" loading="lazy" />
                        </a>
                        <% } %>
                        <% if (showGithubButton) { %>
                          <button
                            type="button"
                            class="github-link-button nav-button"
                            onclick="window.open('https://github.com/alfe-ai', '_blank', 'noopener,noreferrer');"
                            oncontextmenu="window.open('https://github.com/alfe-ai', '_blank', 'noopener,noreferrer'); return false;"
                            title="Open Alfe AI on GitHub" aria-label="Open Alfe AI on GitHub"
                          >
                            GitHub
                            <span aria-hidden="true" class="github-link-icon">
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" focusable="false">
                                <g weight="bold">
                                  <path d="M212.62,75.17A63.7,63.7,0,0,0,206.39,26,12,12,0,0,0,196,20a63.71,63.71,0,0,0-50,24H126A63.71,63.71,0,0,0,76,20a12,12,0,0,0-10.39,6,63.7,63.7,0,0,0-6.23,49.17A61.5,61.5,0,0,0,52,104v8a60.1,60.1,0,0,0,45.76,58.28A43.66,43.66,0,0,0,92,192v4H76a20,20,0,0,1-20-20,44.05,44.05,0,0,0-44-44,12,12,0,0,0,0,24,20,20,0,0,1,20,20,44.05,44.05,0,0,0,44,44H92v12a12,12,0,0,0,24,0V192a20,20,0,0,1,40,0v40a12,12,0,0,0,24,0V192a43.66,43.66,0,0,0-5.76-21.72A60.1,60.1,0,0,0,220,112v-8A61.5,61.5,0,0,0,212.62,75.17ZM196,112a36,36,0,0,1-36,36H112a36,36,0,0,1-36-36v-8a37.87,37.87,0,0,1,6.13-20.12,11.65,11.65,0,0,0,1.58-11.49,39.9,39.9,0,0,1-.4-27.72,39.87,39.87,0,0,1,26.41,17.8A12,12,0,0,0,119.82,68h32.35a12,12,0,0,0,10.11-5.53,39.84,39.84,0,0,1,26.41-17.8,39.9,39.9,0,0,1-.4,27.72,12,12,0,0,0,1.61,11.53A37.85,37.85,0,0,1,196,104Z">
                                  </path>
                                </g>
                              </svg>
                            </span>
                          </button>
                        <% } %>
                          <button id="openGitTreeButton" class="nav-button" type="button" title="Open Git Log" aria-label="Open Git Log">
                              Git Log
                          </button>
                      </div>
                      <div class="top-nav-utility">
                          <button id="agentHelpBtn" style="display:none;" class="nav-button icon-only" type="button" title="Help" aria-label="Open agent help" onclick="(function(){ try{ window.open('/agent/help', '_blank', 'noopener,noreferrer'); }catch(e){} })()">
                              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                  <path d="M8.625 9.75a3.375 3.375 0 116.75 0c0 1.5-1.125 2.25-2.25 3s-1.125 1.5-1.125 2.25" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M12 17.25h.007v.008H12v-.008z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span class="sr-only">Open Sterling Agent help</span>
                        </button>
                        <% if (editorEnabled) { %>
                        <button id="openEditorTopButton" class="nav-button" type="button" title="Open Editor" aria-label="Open Editor" onclick="(function(){ try{ window.__pendingEditorWindow = window.open('about:blank', '_blank', 'noopener,noreferrer'); }catch(e){} })()">Editor</button>
                        <% } %>
                        <button
                            id="sterlingSettingsBtn"
                            class="nav-button icon-only same-height"
                            type="button"
                            title="Settings"
                            aria-label="Open Sterling settings"
                        >
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                <path
                                    d="M10.343 3.94c.09-.54.56-.94 1.11-.94h1.093c.55 0 1.02.4 1.11.94l.149.894c.07.47.48.816.955.816.2 0 .398-.06.568-.17l.737-.494a1.125 1.125 0 011.45.12l.773.774c.39.39.44 1.007.12 1.45l-.494.737a1.125 1.125 0 00-.17.568c0 .475.346.885.816.955l.893.149c.54.09.94.56.94 1.11v1.094c0 .55-.4 1.02-.94 1.11l-.894.149c-.47.07-.816.48-.816.955 0 .2.06.398.17.568l.494.737c.32.443.27 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.494c-.17-.114-.367-.17-.567-.17a1.125 1.125 0 00-.955.816l-.149.894c-.09.54-.56.94-1.11.94h-1.094c-.55 0-1.02-.4-1.11-.94l-.149-.894a1.125 1.125 0 00-.955-.816c-.2 0-.398.056-.568.17l-.737.494a1.125 1.125 0 01-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.494-.737c.114-.17.17-.367.17-.567 0-.475-.346-.885-.816-.955l-.894-.149c-.54-.09-.94-.56-.94-1.11v-1.094c0-.55.4-1.02.94-1.11l.894-.149c.47-.07.816-.48.816-.955 0-.2-.056-.398-.17-.568l-.494-.737a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.494c.17.114.367.17.567.17.475 0 .885-.346.955-.816l.149-.894z"
                                    stroke="currentColor"
                                    stroke-width="1.8"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                                <path
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                    stroke="currentColor"
                                    stroke-width="1.8"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                            <span class="sr-only">Open Sterling settings</span>
                        </button>
                        <button
                            id="signUpLogInBtn"
                            class="nav-button icon-tone"
                            type="button"
                            title="Sign Up or Log In"
                            aria-label="Sign up or log in"
                            onclick="(function(){ if (window.alfeOpenAuthModal) { window.alfeOpenAuthModal('signup'); } })()"
                        >
                            Sign Up / Log In
                        </button>
                        <button
                            id="helpGuideButton"
                            class="nav-button icon-only same-height"
                            type="button"
                            title="Help guide"
                            aria-label="Help guide"
                        >
                            <span aria-hidden="true">?</span>
                            <span class="sr-only">Open help guide</span>
                        </button>
                        <button
                            id="subscribeButton"
                            class="nav-button icon-tone"
                            type="button"
                            title="Subscribe"
                            aria-label="Subscribe"
                            data-subscribe-url="/agent/model-only"
                            style="display:none;"
                        >
                            Subscribe
                        </button>
                    </div>
                </div>
                <% if (!iframeMode) { %>
                <button type="button" id="toggleFieldsButton" class="nav-button is-hidden" aria-pressed="false">
                    Toggle Fields
                </button>
                <% } %>
            </div>
        </div>

        <!-- Demo disclaimer moved below the panel -->
        <div class="demo-disclaimer" aria-live="polite" style="margin-top:6px;color:var(--text-muted);font-weight:500;font-size:0.78rem;">
        </div>
        <h1 id="pageTitle" class="is-hidden">Run Agent from Sterling</h1>
        <p id="pageDescription" class="description is-hidden">
            Provide a project directory and prompt, then watch <code>run_codex.sh</code> stream
            output directly in the browser. This uses server-side streaming to relay stdout and stderr in real time.
        </p>
        <div class="default-model is-hidden" id="defaultModelCard">
            <h2>Default Agent model</h2>
            <p>
                Update the model used when no explicit selection is provided. Enter the full provider and model identifier
                (for example, <code>openrouter/openai/gpt-5-mini</code>).
            </p>
            <div class="default-model-controls">
                <input
                    type="text"
                    id="defaultModelInput"
                    name="defaultModel"
                    placeholder="provider/model"
                    value="<%= defaultCodexModel %>"
                    autocomplete="off"
                    spellcheck="false"
                >
                <button type="button" id="defaultModelSaveButton">Save default</button>
            </div>
            <div id="defaultModelFeedback" class="default-model-feedback hidden" role="status" aria-live="polite"></div>
        </div>
        <form id="codexForm">
            <div id="modelField" class="is-hidden">
                <label for="model">Model</label>
                <select id="model" name="model">
                    <% codexModelGroups.forEach((group) => { %>
                        <optgroup label="<%= group.label %>">
                            <% group.models.forEach((model) => { %>
                                <option value="<%= model %>" <%= model === defaultCodexModel ? "selected" : "" %>><%= model %></option>
                            <% }) %>
                        </optgroup>
                    <% }) %>
                </select>
            </div>
            <div id="projectDirField" class="is-hidden">
                <label for="projectDir">Project directory</label>
                <input type="text" id="projectDir" name="projectDir" placeholder="/path/to/project" autocomplete="off">
            </div>
            <div id="openRouterHeadersField" class="is-hidden">
                <label for="openRouterReferer">OpenRouter HTTP Referer</label>
                <input
                    type="text"
                    id="openRouterReferer"
                    name="openRouterReferer"
                    placeholder="https://your-app.example"
                    autocomplete="off"
                    spellcheck="false"
                    value="<%= defaultOpenRouterReferer %>"
                >
                <label for="openRouterTitle" style="margin-top: 16px; display: block;">OpenRouter X-Title</label>
                <input
                    type="text"
                    id="openRouterTitle"
                    name="openRouterTitle"
                    placeholder="Agent via OpenRouter"
                    autocomplete="off"
                    spellcheck="false"
                    value="<%= defaultOpenRouterTitle %>"
                >
            </div>
            <div id="agentInstructionsField" class="is-hidden">
                <label for="agentInstructions">Agent instructions</label>
                <textarea id="agentInstructions" name="agentInstructions" autocomplete="off"><%= defaultAgentInstructions %></textarea>
                <div class="agent-instructions-actions">
                    <button type="button" id="saveAgentInstructionsButton">Save agent instructions</button>
                </div>
                <div id="agentInstructionsFeedback" class="agent-instructions-feedback hidden" role="status" aria-live="polite"></div>
            </div>
            <div id="fileTreeField" class="file-tree-container is-hidden">
                <div class="file-tree-header">
                    <label for="fileTree">Project file tree</label>
                    <button
                        type="button"
                        id="fileTreeToggleButton"
                        class="file-tree-toggle"
                        aria-pressed="false"
                        aria-label="Enable sending file tree"
                    >
                        Toggle sending file tree
                    </button>
                </div>
                <textarea
                    id="fileTree"
                    name="fileTree"
                    readonly
                    spellcheck="false"
                    autocomplete="off"
                    aria-describedby="fileTreeStatus"
                ></textarea>
                <p id="fileTreeStatus" class="file-tree-status" role="status" aria-live="polite"></p>
            </div>
            <div id="gitFpushField" class="git-fpush-container is-hidden">
                <div class="git-fpush-header">
                    <span class="git-fpush-label">Automatic git push</span>
                    <button
                        type="button"
                        id="gitFpushToggleButton"
                        class="git-fpush-toggle"
                        aria-pressed="true"
                        aria-label="Disable git_fpush.sh"
                    >
                        Disable git_fpush.sh
                    </button>
                </div>
                <p class="git-fpush-description">
                    When enabled, run <code>git_fpush.sh</code> automatically after a successful Agent run.
                </p>
            </div>
            <div>
                <label for="prompt">Prompt</label>
                <textarea
                    id="prompt"
                    name="prompt"
                    placeholder="<% const _s = ['Make a snake game.', 'Create a to-do app.', 'Build a calculator.', 'Implement a chat UI.', 'Write unit tests for a module.', 'Create a REST API endpoint.']; %>Start a new task or ask a question

Try: <%= _s[Math.floor(Math.random()*_s.length)] %>"
                    required
                    autocomplete="off"
                    spellcheck="false"
                    rows="6"
                ></textarea>
            </div>

            <div class="actions">
                <button
                    type="button"
                    id="updateBranchButton"
                    class="secondary"
                    title="Update this branch with changes from its parent"
                >
                    Pull updates
                </button>
                <div class="merge-button-wrapper" id="mergeButtonWrapper">
                    <button
                        type="button"
                        id="mergeButton"
                        class="secondary"
                        disabled
                        aria-disabled="true"
                        title="Merge is available after&#10;agent finishes running."
                    >
                        <svg aria-hidden="true" focusable="false" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right:8px;opacity:0.95;">
                            <path d="M18 3a2 2 0 11-4 0 2 2 0 014 0zM6 21a2 2 0 11-4 0 2 2 0 014 0zM18 21a2 2 0 11-4 0 2 2 0 014 0zM8.5 12.5l6-3v3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Merge</span>
                    </button>
                    <div class="merge-disabled-tooltip" id="mergeDisabledTooltip" role="tooltip" aria-hidden="true">
                        Merge is available after<br />agent finishes running.
                    </div>
                </div>


                <button type="button" id="deleteLocalButton" class="secondary" title="Delete local checkout" style="margin-left:8px; display:none;">
                    <svg aria-hidden="true" focusable="false" width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right:6px;opacity:0.95;">
                        <path d="M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Delete local</span>
                </button>

                <button type="submit" id="runButton" class="run-submit" aria-label="Run Agent">
                    <svg class="run-icon-send" aria-hidden="true" focusable="false" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <line x1="22" y1="2" x2="11" y2="13" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></line>
                      <polygon points="22 2 15 22 11 13 2 9 22 2" fill="currentColor"></polygon>
                    </svg>
                    <svg class="run-icon-stop" aria-hidden="true" focusable="false" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="6" y="6" width="12" height="12" rx="2" ry="2" fill="currentColor"></rect>
                    </svg>
                    <span id="runButtonLabel" class="sr-only">Run Agent</span>
                </button>
            </div>
            <div id="pythonTestField" class="python-test is-hidden">
                <div class="python-test-header" style="display:flex;align-items:center;gap:12px;">
                    <span class="python-test-label">Python command test</span>
                    <button type="button" id="pythonTestToggleButton" class="file-tree-toggle" aria-pressed="false" aria-label="Enable python command test">Enable python command test</button>
                </div>
                <button type="button" id="testPythonButton" class="secondary" aria-describedby="pythonTestResult" disabled aria-disabled="true">
                    Test python command
                </button>
                <p id="pythonTestResult" class="python-test-result" role="status" aria-live="polite"></p>
            </div>
        </form>

        <div id="status" class="status status-idle"><span id="statusText" class="status-text">Waiting to start</span></div>
        <div
            id="userPromptPreview"
            class="status status-idle prompt-preview"
            role="button"
            tabindex="0"
            aria-hidden="true"
            aria-haspopup="dialog"
            aria-expanded="false"
        >
            <span id="userPromptPreviewText" class="status-text prompt-preview-text"></span>
            <span class="prompt-preview-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 5h10v10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M5 19l14-14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </span>
        </div>
        <div id="outputTabs" class="output-tabs is-hidden" role="tablist" aria-label="Agent output views">
            <button
                type="button"
                id="fullOutputTabButton"
                class="tab-button active"
                role="tab"
                aria-selected="true"
                aria-controls="output"
                tabindex="0"
            >
                Full output
            </button>
            <button
                type="button"
                id="stdoutTabButton"
                class="tab-button"
                role="tab"
                aria-selected="false"
                aria-controls="stdoutOutput"
                tabindex="-1"
            >
                Final output
            </button>
        </div>
        <div id="output" class="log-output" role="log" aria-live="polite"></div>
        <div id="stdoutOutput" class="log-output is-hidden" role="log" aria-live="polite"></div>
        <% if (showRunDirectory) { %>
            <div id="runDirectoryNotice" style="margin-top:8px;color:var(--text-muted);font-weight:500;font-size:0.78rem;">
                <small>Run directory: <code id="runDirectoryCode"><%= projectDir || defaultProjectDir %></code></small>
            </div>
            <div id="gitFpushRevisionNotice" class="is-hidden" style="margin-top:4px;color:var(--text-muted);font-weight:500;font-size:0.78rem;">
                <small>Commit revision: <code id="gitFpushRevisionCode"></code></small>
            </div>
        <% } %>
        <div id="mergeOutputContainer" class="is-hidden">
            <div class="merge-header" style="display:flex;align-items:center;gap:12px;justify-content:space-between;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <button id="mergeToggleButton" class="tab-button" type="button" aria-expanded="false">Show merge output</button>
                    <span id="mergeSummary" class="status-text">&nbsp;</span>
                </div>
                <div style="margin-left:12px;">
                    <!-- View Diff visible before merge -->
                    <button id="openMergeDiffButton" class="nav-button" type="button" title="View Diff" aria-label="View Diff" disabled>
                        View Diff
                    </button>
                </div>
            </div>
            <div id="mergeOutput" class="log-output is-hidden" role="log" aria-live="polite"></div>
        </div>

        <div id="followupSessions" class="is-hidden" aria-live="polite"></div>

        <div class="meta is-hidden" id="metaSection">
            <p>Default project directory: <code><%= defaultProjectDir %></code></p>
            <p>Agent runner script: <code><%= codexScriptPath %></code></p>
        </div>
        </div>
    </div>
    </div>


    <div id="promptModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-labelledby="promptModalHeader">
      <div class="modal-content prompt-modal-content">
        <button class="modal-close" type="button" id="promptModalCloseButton"></button>
        <div class="prompt-modal-body" style="position:relative;">
          <h3 id="promptModalHeader" class="prompt-modal-header">Your Sent Prompt</h3>
          <button id="promptModalCopyButton" type="button" class="code-copy-btn" title="Copy prompt" aria-label="Copy prompt" style="position:absolute;top:12px;right:12px;font-size:16px;line-height:1;padding:6px;border-radius:4px;border:0;background:transparent;cursor:pointer;"></button>
          <textarea
            id="promptModalTextarea"
            readonly
            spellcheck="false"
            autocomplete="off"
            aria-labelledby="promptModalHeader"
          ></textarea>
        </div>
      </div>
    </div>

    <div id="authModal" class="modal-overlay is-hidden auth-modal" role="dialog" aria-modal="true" aria-label="Sign Up or Log In">
        <div class="modal-content modal-content--auth">
            <button class="modal-close" type="button" id="authModalCloseButton"></button>
            <div class="modal-title-row">
              <h2>Sign Up / Log In</h2>
            </div>
            <div id="authEmailStep">
              <label class="auth-email-label">Email:<br/>
                <input type="email" id="authEmailInput" style="width:100%;" />
              </label>
              <div class="modal-buttons">
                <button id="authEmailContinueBtn" class="primary">Continue</button>
              </div>
            </div>
            <div id="loginForm" style="display:none;">
              <div class="modal-buttons">
                <button id="loginChangeEmailBtn">Use different email</button>
              </div>
              <p>Email: <span id="authEmailDisplayLogin"></span></p>
              <input type="hidden" id="loginEmail" />
              <label style="margin-top:8px;">Password:<br/>
                <input type="password" id="loginPassword" style="width:100%;" />
              </label>
              <label id="totpLoginLabel" style="margin-top:8px; display:none;">Auth Code:<br/>
                <input type="text" id="loginTotp" style="width:100%;" />
              </label>
              <div class="modal-buttons">
                <button id="loginSubmitBtn">Login</button>
              </div>
            </div>
            <div id="signupForm" style="display:none;">
              <div class="modal-buttons">
                <button id="signupChangeEmailBtn">Use different email</button>
              </div>
              <p>Email: <span id="authEmailDisplaySignup"></span></p>
              <input type="hidden" id="signupEmail" />
              <label style="margin-top:8px;">Password:<br/>
                <input type="password" id="signupPassword" style="width:100%;" />
              </label>
              <label style="margin-top:8px;">Confirm Password:<br/>
                <input type="password" id="signupConfirm" style="width:100%;" />
              </label>
              <div class="password-requirements" aria-live="polite">
                <p class="password-requirements__title password-requirements__check" data-requirement="min-8" role="checkbox" aria-checked="false">Must have at least 8 characters</p>
                <p class="password-requirements__subtitle">It's best to have:</p>
                <ul class="password-requirements__list">
                  <li class="password-requirements__item password-requirements__check" data-requirement="min-12" role="checkbox" aria-checked="false">At least 12 characters</li>
                  <li class="password-requirements__item password-requirements__check" data-requirement="case" role="checkbox" aria-checked="false">Uppercase and lowercase letters</li>
                  <li class="password-requirements__item password-requirements__check" data-requirement="number" role="checkbox" aria-checked="false">Numbers</li>
                  <li class="password-requirements__item password-requirements__check" data-requirement="symbol" role="checkbox" aria-checked="false">Symbols (#$&amp;)</li>
                </ul>
              </div>
              <div class="modal-buttons">
                <button id="signupSubmitBtn" class="primary">Register</button>
              </div>
            </div>
        </div>
    </div>

    <div id="accountModal" class="modal-overlay is-hidden auth-modal account-modal" role="dialog" aria-modal="true" aria-label="Account information">
        <div class="modal-content modal-content--auth">
            <button class="modal-close" type="button" id="accountModalCloseButton"></button>
            <div class="modal-title-row">
                <h2>Account</h2>
            </div>
            <p>Here are the details for your current session.</p>
            <ul class="account-details">
                <li><span>Email</span><strong id="accountEmailValue"></strong></li>
                <li><span>Plan</span><strong id="accountPlanValue"></strong></li>
                <li><span>Session</span><strong id="accountSessionValue"></strong></li>
            </ul>
        </div>
    </div>

    <div id="usageLimitModal" class="modal-overlay is-hidden usage-limit-modal" role="dialog" aria-modal="true" aria-label="Usage limit reached">
        <div class="modal-content">
            <button class="modal-close" type="button" id="usageLimitModalCloseButton" onclick="(function(){ const modal=document.getElementById('usageLimitModal'); if(modal) modal.classList.add('is-hidden'); document.body.style.overflow=''; })()"></button>
            <h2>Usage limit reached</h2>
            <div>
                <div class="support-ticket" aria-live="polite">
                    <div style="display:flex;flex-direction:column;gap:12px;">
                        <div>
                            <h4 style="margin:0 0 6px 0;font-size:0.95rem;color:#e2e8f0;">Code</h4>
                            <div id="usageLimitCodeUsageLimited" style="display:flex;align-items:center;gap:8px;">
                                <div style="flex:1;height:6px;background:#1e293b;border-radius:999px;overflow:hidden;">
                                    <div id="usageLimitCodeUsageBarFill" style="height:100%;width:0%;background:#38bdf8;"></div>
                                </div>
                                <span id="usageLimitCodeUsageLimit" style="font-size:0.85rem;color:#94a3b8;white-space:nowrap;">0/20 code runs</span>
                            </div>
                            <div id="usageLimitFreeCodeUsageUpsell" class="is-hidden" style="margin-top:8px;display:flex;flex-direction:column;align-items:flex-start;gap:6px;">
                                <span style="font-size:0.95rem;color:#e2e8f0;font-weight:600;">Subscribe for Unlimited use.</span>
                                <button type="button" class="subscribe-button subscribe-button--inline">Subscribe Now</button>
                            </div>
                            <div id="usageLimitLoggedOutCodeUsageUpsell" class="is-hidden" style="margin-top:8px;display:flex;flex-direction:column;align-items:flex-start;gap:6px;">
                                <span style="font-size:0.95rem;color:#e2e8f0;font-weight:600;">Log in for increased limits.</span>
                                <button type="button" class="subscribe-button subscribe-button--inline">Log In / Sign Up</button>
                            </div>
                        </div>
                    </div>
                    <hr style="border:0;border-top:1px solid #1e293b;margin:12px 0 8px 0;">
                    <p style="margin:12px 0 0 0;font-size:0.8rem;color:#94a3b8;">All limits are monthly.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <div id="switchBranchModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-labelledby="switchBranchModalTitle">
      <div class="modal-content">
        <button class="modal-close" type="button" id="switchBranchModalCloseButton"></button>
        <div class="switch-branch-header">
          <h2 id="switchBranchModalTitle">Switch Branch</h2>
          <button type="button" class="switch-branch-create" id="switchBranchCreateButton">Or Create a New Branch</button>
        </div>
        <div id="branchSelectContainer">
          <label for="branchSelect">Select existing branch:</label>
          <select id="branchSelect"></select>
          <div class="switch-branch-actions">
            <button type="button" class="nav-button" id="switchBranchSubmitButton">Switch</button>
          </div>
          <div id="switchBranchMessage" class="switch-branch-message" role="status" aria-live="polite"></div>
        </div>
      </div>
    </div>

    <div id="gitTreeModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="Git Log">
      <div class="modal-content">
        <button class="modal-close" type="button" onclick="(function(){ const modal=document.getElementById('gitTreeModal'); const iframe=document.getElementById('gitTreeIframe'); if(iframe) iframe.src=''; if(modal) modal.classList.add('is-hidden'); document.body.style.overflow=''; })()"></button>
        <iframe id="gitTreeIframe" class="modal-iframe" src="/agent/git-tree" title="Git Log"></iframe>
      </div>
    </div>
    <div id="gitLogModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="Git Diff">
      <div class="modal-content">
        <button class="modal-close" type="button" onclick="(function(){ const modal=document.getElementById('gitLogModal'); const iframe=document.getElementById('gitLogIframe'); if(iframe) iframe.src=''; if(modal) modal.classList.add('is-hidden'); document.body.style.overflow=''; })()"></button>
        <div id="gitLogLoader" class="git-log-loader is-hidden" role="status" aria-live="polite">
            <div class="loading-card">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p class="loading-title">Loading Diff</p>
                <p id="gitLogLoaderLog" class="loading-log">Preparing diff</p>
            </div>
        </div>

        <iframe id="gitLogIframe" class="modal-iframe" src="" title="Git Diff"></iframe>
      </div>
    </div>

    <div id="aboutModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="About Alfe AI">
      <div class="modal-content">
        <button class="modal-close" type="button" id="aboutModalCloseButton"></button>
        <iframe id="aboutModalIframe" class="modal-iframe" src="" title="About Alfe AI"></iframe>
      </div>
    </div>

    <div id="repoAddModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="Connect Git Repository">
      <div class="modal-content">
        <button class="modal-close" type="button" id="repoAddCloseButton"></button>
        <div id="repoAddLoader" class="repo-add-loader is-hidden" role="status" aria-live="polite">
            <div class="loading-card">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p class="loading-title">Loading Repository Form</p>
            </div>
        </div>
        <iframe
          id="repoAddIframe"
          class="modal-iframe"
          src=""
          data-default-src="/repositories/add"
          title="Connect Git Repository"
        ></iframe>
      </div>
    </div>

    <div id="sterlingSettingsModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="Settings">
      <div class="modal-content" style="position:relative;min-height:140px;max-width:980px;margin:auto; width:90%;">
        <button class="modal-close" type="button" id="sterlingSettingsCloseButton"></button>
        <div id="sterlingSettingsLoader" class="settings-modal-loader is-hidden" role="status" aria-live="polite">
            <div class="loading-card">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p class="loading-title">Loading Settings</p>
            </div>
        </div>
        <iframe
          id="sterlingSettingsIframe"
          class="modal-iframe"
          src=""
          data-default-src="/agent/model-only"
          title="Settings"
          style="width:100%;height:80vh;border:0;border-radius:6px;"
        ></iframe>
      </div>
    </div>

    <div id="helpGuideModal" class="modal-overlay is-hidden" role="dialog" aria-modal="true" aria-label="Help guide">
      <div class="modal-content" style="position:relative;min-height:140px;max-width:980px;margin:auto; width:90%;">
        <button class="modal-close" type="button" id="helpGuideCloseButton"></button>
        <div id="helpGuideLoader" class="settings-modal-loader is-hidden" role="status" aria-live="polite">
            <div class="loading-card">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p class="loading-title">Loading Help</p>
            </div>
        </div>
        <iframe
          id="helpGuideIframe"
          class="modal-iframe"
          src=""
          data-default-src="/help.html"
          title="Help guide"
          style="width:100%;height:80vh;border:0;border-radius:6px;"
        ></iframe>
      </div>
    </div>

    <script>
        window.CODEX_RUNNER_CONFIG = Object.assign(
            {},
            window.CODEX_RUNNER_CONFIG || {},
            {
                defaultProjectDir: <%- JSON.stringify(defaultProjectDir || "") %>,
                defaultModel: <%- JSON.stringify(defaultCodexModel || "") %>,
                defaultAgentInstructions: <%- JSON.stringify(defaultAgentInstructions || "") %>,
                defaultOpenRouterReferer: <%- JSON.stringify(defaultOpenRouterReferer || "") %>,
                defaultOpenRouterTitle: <%- JSON.stringify(defaultOpenRouterTitle || "") %>,
                isIframeMode: <%- JSON.stringify(!!iframeMode) %>,
                editorLaunchConfig: <%- JSON.stringify(editorLaunchConfig || null) %>,
                enableFollowups: <%- JSON.stringify(enableFollowups || false) %>,
                defaultSubmitOnEnter: <%- JSON.stringify(typeof defaultSubmitOnEnter === 'undefined' ? true : defaultSubmitOnEnter) %>,
                accountButtonEnabled: <%- JSON.stringify(typeof accountButtonEnabled === "undefined" ? true : accountButtonEnabled) %>,
            }
        );
    </script>
                    <script src="/JS/codex_runner.js" defer></script>

<script>
(function(){
  const sidebar = document.getElementById('runsSidebar');
  // Prefer the repo header button for the repositories dropdown; fall back to the Runs title if unavailable.
  const repoDropdownTriggerButton = document.getElementById('repoDropdownTrigger');
  const repoTriggerEl = repoDropdownTriggerButton || document.getElementById('runsSidebarTitle');
  const reposDropdown = document.getElementById('reposDropdown');
  const reposIframe = document.getElementById('reposDropdownIframe');
  const projectInfo = document.getElementById('projectInfo');
  const branchesDropdown = document.getElementById('branchesDropdown');
  const branchesIframe = document.getElementById('branchesDropdownIframe');

  if(!sidebar) { return; }

  const hideDropdown = (dropdownEl, triggerEl) => {
    if(!dropdownEl) return;
    dropdownEl.classList.remove('is-visible');
    dropdownEl.classList.add('is-hidden');
    dropdownEl.setAttribute('aria-hidden','true');
    if(triggerEl) {
      triggerEl.setAttribute('aria-expanded','false');
    }
  };

  const positionDropdown = (triggerEl, dropdownEl) => {
    if(!triggerEl || !dropdownEl) return;
    const triggerRect = triggerEl.getBoundingClientRect();
    const sidebarRect = sidebar.getBoundingClientRect();
    dropdownEl.style.left = `${triggerRect.left - sidebarRect.left}px`;
    dropdownEl.style.top = `${triggerRect.bottom - sidebarRect.top + 6}px`;
  };

  const showDropdown = (triggerEl, dropdownEl) => {
    if(!triggerEl || !dropdownEl) return;
    positionDropdown(triggerEl, dropdownEl);
    dropdownEl.classList.add('is-visible');
    dropdownEl.classList.remove('is-hidden');
    dropdownEl.setAttribute('aria-hidden','false');
    triggerEl.setAttribute('aria-expanded','true');
  };

  const hideAllDropdowns = () => {
    hideDropdown(reposDropdown, repoTriggerEl);
    hideDropdown(branchesDropdown, projectInfo);
    if(projectInfo) {
      projectInfo.classList.remove('is-open');
    }
  };

  if(repoTriggerEl && reposDropdown) {
    const toggleReposDropdown = (ev) => {
      if(ev) {
        ev.stopPropagation();
      }
      if(reposDropdown.classList.contains('is-visible')) {
        hideDropdown(reposDropdown, repoTriggerEl);
      } else {
        hideDropdown(branchesDropdown, projectInfo);
        if(projectInfo) {
          projectInfo.classList.remove('is-open');
        }
        showDropdown(repoTriggerEl, reposDropdown);
      }
    };

    const isButtonTrigger = repoTriggerEl.tagName === 'BUTTON';
    if(!isButtonTrigger) {
      repoTriggerEl.style.cursor = 'pointer';
      repoTriggerEl.setAttribute('role', 'button');
      repoTriggerEl.setAttribute('tabindex', '0');
      repoTriggerEl.setAttribute('aria-controls', 'reposDropdown');
    } else {
      if(!repoTriggerEl.hasAttribute('aria-controls')) {
        repoTriggerEl.setAttribute('aria-controls', 'reposDropdown');
      }
    }
    repoTriggerEl.setAttribute('aria-expanded', 'false');

    repoTriggerEl.addEventListener('click', toggleReposDropdown);

    if(!isButtonTrigger) {
      repoTriggerEl.addEventListener('keydown', (ev) => {
        if(ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          toggleReposDropdown(ev);
        }
      });
    }
  }

  if(reposDropdown) {
    reposDropdown.addEventListener('click', (ev) => ev.stopPropagation());
  }

  if(reposIframe) {
    reposIframe.addEventListener('load', () => {
      try {
        const doc = reposIframe.contentDocument || reposIframe.contentWindow.document;
        if(doc) {
          doc.querySelectorAll('a').forEach((anchor) => {
            anchor.setAttribute('target', '_blank');
            anchor.setAttribute('rel', 'noopener noreferrer');
          });
        }
      } catch(_err) {
        // Ignore cross-origin errors
      }
    });
  }

  const buildBranchesUrl = () => {
    if(!projectInfo) return '/agent/git-tree';
    const dir = projectInfo.dataset.projectDir || '';
    if(!dir) return '/agent/git-tree';
    const params = new URLSearchParams({ projectDir: dir });
    return `/agent/git-tree?${params.toString()}`;
  };

  const ensureBranchesSrc = () => {
    if(!branchesIframe) return;
    const nextSrc = buildBranchesUrl();
    if(branchesIframe.dataset.currentSrc === nextSrc) return;
    branchesIframe.dataset.currentSrc = nextSrc;
    branchesIframe.src = nextSrc;
  };

  if(branchesDropdown) {
    branchesDropdown.addEventListener('click', (ev) => ev.stopPropagation());
  }

  document.addEventListener('click', hideAllDropdowns);
  window.addEventListener('resize', hideAllDropdowns);

})();

  // Sterling Settings button behavior
  const sterlingSettingsBtn = document.getElementById('sterlingSettingsBtn');
  const sterlingSettingsModal = document.getElementById('sterlingSettingsModal');
  const sterlingSettingsIframe = document.getElementById('sterlingSettingsIframe');
  const sterlingSettingsCloseButton = document.getElementById('sterlingSettingsCloseButton');
  const sterlingSettingsLoader = document.getElementById('sterlingSettingsLoader');
  const showSettingsLoader = () => {
    if (sterlingSettingsLoader) {
      sterlingSettingsLoader.classList.remove('is-hidden');
    }
    if (sterlingSettingsIframe) {
      sterlingSettingsIframe.classList.add('is-loading');
    }
  };
  const hideSettingsLoader = () => {
    if (sterlingSettingsLoader) {
      sterlingSettingsLoader.classList.add('is-hidden');
    }
    if (sterlingSettingsIframe) {
      sterlingSettingsIframe.classList.remove('is-loading');
    }
  };
  if(sterlingSettingsBtn && sterlingSettingsModal){
    const defaultSettingsUrl = (sterlingSettingsIframe && (sterlingSettingsIframe.dataset.defaultSrc || sterlingSettingsIframe.getAttribute('data-default-src'))) || '/agent/model-only';
    sterlingSettingsBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      showSettingsLoader();
      if (sterlingSettingsIframe) {
        const currentSrcAttr = sterlingSettingsIframe.getAttribute('src');
        if (!currentSrcAttr || currentSrcAttr === '') {
          sterlingSettingsIframe.src = defaultSettingsUrl;
        } else if (sterlingSettingsIframe.contentDocument && sterlingSettingsIframe.contentDocument.readyState === 'complete') {
          hideSettingsLoader();
        }
      }
      sterlingSettingsModal.classList.remove('is-hidden');
      document.body.style.overflow='hidden';
    });
  }
  if(sterlingSettingsCloseButton && sterlingSettingsModal){
    sterlingSettingsCloseButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      sterlingSettingsModal.classList.add('is-hidden');
      document.body.style.overflow='';
      hideSettingsLoader();
      if(sterlingSettingsIframe){
        sterlingSettingsIframe.src = '';
      }
    });
  }
  if (sterlingSettingsIframe) {
    sterlingSettingsIframe.addEventListener('load', () => {
      hideSettingsLoader();
    });
    sterlingSettingsIframe.addEventListener('error', () => {
      hideSettingsLoader();
    });
  }

  (function(){
    const helpGuideButton = document.getElementById('helpGuideButton');
    const STORAGE_KEY_HELP_BUTTON = 'showHelpButton';
    if (!helpGuideButton) return;
    const setHelpButtonVisible = (show) => {
      if (show) {
        helpGuideButton.classList.remove('is-hidden');
        helpGuideButton.removeAttribute('aria-hidden');
      } else {
        helpGuideButton.classList.add('is-hidden');
        helpGuideButton.setAttribute('aria-hidden', 'true');
      }
    };
    let storedValue = null;
    try {
      storedValue = localStorage.getItem(STORAGE_KEY_HELP_BUTTON);
    } catch (_e) {
      storedValue = null;
    }
    if (storedValue === null) {
      storedValue = 'true';
    }
    setHelpButtonVisible(storedValue === 'true');
    window.addEventListener('message', function(ev){
      try {
        const d = ev && ev.data;
        if (!d || d.type !== 'sterling:settings' || d.key !== 'showHelpButton') return;
        const shouldShow = d.value === true || d.value === 'true';
        try{ localStorage.setItem(STORAGE_KEY_HELP_BUTTON, shouldShow ? 'true' : 'false'); }catch(_e){}
        setHelpButtonVisible(shouldShow);
      } catch(_e) { /* noop */ }
    });
  })();

  const helpGuideButton = document.getElementById('helpGuideButton');
  const helpGuideModal = document.getElementById('helpGuideModal');
  const helpGuideIframe = document.getElementById('helpGuideIframe');
  const helpGuideCloseButton = document.getElementById('helpGuideCloseButton');
  const helpGuideLoader = document.getElementById('helpGuideLoader');
  const showHelpGuideLoader = () => {
    if (helpGuideLoader) {
      helpGuideLoader.classList.remove('is-hidden');
    }
    if (helpGuideIframe) {
      helpGuideIframe.classList.add('is-loading');
    }
  };
  const hideHelpGuideLoader = () => {
    if (helpGuideLoader) {
      helpGuideLoader.classList.add('is-hidden');
    }
    if (helpGuideIframe) {
      helpGuideIframe.classList.remove('is-loading');
    }
  };
  if (helpGuideButton && helpGuideModal) {
    const defaultHelpUrl = (helpGuideIframe && (helpGuideIframe.dataset.defaultSrc || helpGuideIframe.getAttribute('data-default-src'))) || '/help.html';
    helpGuideButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      showHelpGuideLoader();
      if (helpGuideIframe) {
        const currentSrcAttr = helpGuideIframe.getAttribute('src');
        if (!currentSrcAttr || currentSrcAttr === '') {
          helpGuideIframe.src = defaultHelpUrl;
        } else if (helpGuideIframe.contentDocument && helpGuideIframe.contentDocument.readyState === 'complete') {
          hideHelpGuideLoader();
        }
      }
      helpGuideModal.classList.remove('is-hidden');
      document.body.style.overflow = 'hidden';
    });
  }
  if (helpGuideCloseButton && helpGuideModal) {
    helpGuideCloseButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      helpGuideModal.classList.add('is-hidden');
      document.body.style.overflow = '';
      hideHelpGuideLoader();
      if (helpGuideIframe) {
        helpGuideIframe.src = '';
      }
    });
  }
  if (helpGuideIframe) {
    helpGuideIframe.addEventListener('load', () => {
      hideHelpGuideLoader();
    });
    helpGuideIframe.addEventListener('error', () => {
      hideHelpGuideLoader();
    });
  }

  const aboutModalButton = document.getElementById('aboutModalButton');
  const aboutModal = document.getElementById('aboutModal');
  const aboutModalIframe = document.getElementById('aboutModalIframe');
  const aboutModalCloseButton = document.getElementById('aboutModalCloseButton');
  if(aboutModalButton && aboutModal){
    aboutModalButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      if(aboutModalIframe){
        aboutModalIframe.src = '/about.html';
      }
      aboutModal.classList.remove('is-hidden');
      document.body.style.overflow = 'hidden';
    });
  }
  if(aboutModalCloseButton && aboutModal){
    aboutModalCloseButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      aboutModal.classList.add('is-hidden');
      document.body.style.overflow = '';
      if(aboutModalIframe){
        aboutModalIframe.src = '';
      }
    });
  }

  const repoAddModal = document.getElementById('repoAddModal');
  const repoAddIframe = document.getElementById('repoAddIframe');
  const repoAddCloseButton = document.getElementById('repoAddCloseButton');
  const repoAddLoader = document.getElementById('repoAddLoader');
  const showRepoAddLoader = () => {
    if (repoAddLoader) {
      repoAddLoader.classList.remove('is-hidden');
    }
    if (repoAddIframe) {
      repoAddIframe.classList.add('is-loading');
    }
  };
  const hideRepoAddLoader = () => {
    if (repoAddLoader) {
      repoAddLoader.classList.add('is-hidden');
    }
    if (repoAddIframe) {
      repoAddIframe.classList.remove('is-loading');
    }
  };
  const openRepoAddModal = function() {
    if (!repoAddModal) return;
    const defaultRepoAddUrl = (repoAddIframe && (repoAddIframe.dataset.defaultSrc || repoAddIframe.getAttribute('data-default-src'))) || '/repositories/add';
    showRepoAddLoader();
    if (repoAddIframe) {
      const currentSrc = repoAddIframe.getAttribute('src');
      if (!currentSrc || currentSrc === '') {
        repoAddIframe.src = defaultRepoAddUrl;
      } else if (repoAddIframe.contentDocument && repoAddIframe.contentDocument.readyState === 'complete') {
        hideRepoAddLoader();
      }
    }
    repoAddModal.classList.remove('is-hidden');
    document.body.style.overflow = 'hidden';
    const reposDropdown = document.getElementById('reposDropdown');
    if (reposDropdown) {
        reposDropdown.classList.add('is-hidden');
        reposDropdown.setAttribute('aria-hidden', 'true');
    }
  };
  if (repoAddCloseButton && repoAddModal) {
    repoAddCloseButton.addEventListener('click', (ev) => {
      ev.stopPropagation();
      repoAddModal.classList.add('is-hidden');
      document.body.style.overflow = '';
      hideRepoAddLoader();
      if (repoAddIframe) {
        repoAddIframe.src = '';
      }
    });
  }
  if (repoAddIframe) {
    repoAddIframe.addEventListener('load', () => {
      hideRepoAddLoader();
    });
    repoAddIframe.addEventListener('error', () => {
      hideRepoAddLoader();
    });
  }
  window.addEventListener('message', function(ev){
    const data = ev && ev.data;
    if (!data || data.type !== 'sterling:open-repo-add') return;
    openRepoAddModal();
  });



// STERLING_GIT_BUTTON_SCRIPT
(function(){
  try{
    var gitButtonPref = (function(){ try{ return localStorage.getItem('sterling.gitButtonTarget') || 'git-log'; }catch(e){ return 'git-log'; } })();
    window.addEventListener('message', function(ev){
      try{
        var d = ev && ev.data;
        if(!d || d.type !== 'sterling:settings' || d.key !== 'gitButtonTarget') return;
        if(typeof d.value === 'string'){
          gitButtonPref = d.value;
          try{ localStorage.setItem('sterling.gitButtonTarget', gitButtonPref); }catch(e){}
        }
      }catch(e){}
    });
    var btn = document.getElementById('openGitTreeButton');
    if(!btn) return;
    btn.addEventListener('click', function(ev){
      ev.preventDefault();
      try{
        // Ensure we respect the latest user preference (fallback to localStorage)
        try {
          var __storedGitBtn = (function(){ try{ return localStorage.getItem('sterling.gitButtonTarget'); }catch(e){ return null; } })();
          var __candidateGitBtn = (typeof __storedGitBtn === 'string' && __storedGitBtn ? __storedGitBtn : gitButtonPref);
          if (typeof __candidateGitBtn === 'string') {
            try {
              var __maybeParsed = JSON.parse(__candidateGitBtn);
              if (typeof __maybeParsed === 'string') __candidateGitBtn = __maybeParsed;
            } catch(__ignored) { /* ignore parse issues */ }
            var __normalizedGitBtn = __candidateGitBtn.trim().toLowerCase();
            if (__normalizedGitBtn === 'git-tree' || __normalizedGitBtn === 'git-log') {
              gitButtonPref = __normalizedGitBtn;
            }
          }
        } catch(_e) { /* ignore */ }

        var dirInput = document.getElementById('projectDir');
        var dir = (dirInput && dirInput.value && dirInput.value.trim()) ? dirInput.value.trim() : '';
        var url = '';
        if(gitButtonPref === 'git-tree'){
          url = '/agent/git-tree' + (dir ? ('?projectDir=' + encodeURIComponent(dir)) : '');
          var modal = document.getElementById('gitTreeModal');
          var iframe = document.getElementById('gitTreeIframe');
          if(iframe) iframe.src = url;
          if(modal) { modal.classList.remove('is-hidden'); document.body.style.overflow = 'hidden'; }
        } else {
          // default to git-log
          url = '/agent/git-log' + (dir ? ('?projectDir=' + encodeURIComponent(dir)) : '');
          var modal = document.getElementById('gitLogModal');
          var iframe = document.getElementById('gitLogIframe');
          var loader = document.getElementById('gitLogLoader');
          if(loader) loader.classList.remove('is-hidden');
          if(iframe) iframe.src = url;
          if(modal) { modal.classList.remove('is-hidden'); document.body.style.overflow = 'hidden'; }
          // hide loader after short delay if present; actual git-log script will manage loading state
          setTimeout(function(){ if(loader) loader.classList.add('is-hidden'); }, 1200);
        }
      }catch(e){ try{ window.open('/agent/git-tree', '_blank'); }catch(_e){} }
    });
  }catch(e){}
})();

// END STERLING_GIT_BUTTON_SCRIPT
</script>

<%- include('partials/cookie_banner') %>

</body>
</html>

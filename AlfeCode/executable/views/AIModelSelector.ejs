<div class="ai-selectors">
    <select name="aiProvider" id="aiProvider" onchange="this.form.submit()">
        <option value="openrouter" <%= chatData.aiProvider.toLowerCase() === 'openrouter' ? 'selected' : '' %>>OpenRouter</option>
        <option value="litellm" <%= chatData.aiProvider.toLowerCase() === 'litellm' ? 'selected' : '' %>>LiteLLM</option>
        <option value="deepseek api" <%= chatData.aiProvider.toLowerCase() === 'deepseek api' ? 'selected' : '' %>>DeepSeek API</option>
        <option value="deepseek local" <%= chatData.aiProvider.toLowerCase() === 'deepseek local' ? 'selected' : '' %>>DeepSeek Local</option>
    </select>
    <select name="aiModel" id="aiModel" onchange="this.form.submit()">
        <% 
            const filtered = (AIModels || []).filter(m => {
                const id = m && typeof m.id === 'string' ? m.id : '';
                // Allow Lite/Plus/Pro users to see plus_model: true models
                if (['Lite', 'Plus', 'Pro'].includes(chatData.plan)) {
                    return m.plus_model;
                }
                // Default to existing filter for other plans
                return id.toLowerCase().includes('gpt-5');
            });
        %>
        <% if (filtered && filtered.length > 0) { %>
            <% filtered.forEach(function(model) { %>
                <option value="<%= model.id %>" <%= model.id === aiModel ? 'selected' : '' %>>
                    <%= model.name || model.id %><% if (model.contextLimitLabel && model.contextLimitLabel !== 'N/A') { %> (<span class="context-limit"><%= model.contextLimitLabel %></span>)<% } %>
                </option>
            <% }); %>
        <% } else { %>
            <option value="<%= aiModel %>" selected><%= aiModel %></option>
        <% } %>
    </select>
</div>

[content truncated – unchanged before the main <script> tag]

<script>
/* ---------------- constants ---------------- */
const columns = [
  { key: "order", label: "P" },
  { key: "reorder", label: "↕" },
  { key: "visibility", label: "" },
  { key: "priority", label: "Prio" },
  { key: "slug", label: "Slug" },
  { key: "repo", label: "Repo" },
  { key: "number", label: "#" },
  { key: "title", label: "Title" },
  { key: "project", label: "Project" },
  { key: "sprint", label: "Sprint" },
  { key: "points", label: "Pts" },
  { key: "assignee", label: "Assignee" },
  { key: "created", label: "Created" }
];

/* --------------- state --------------------- */
let visibleCols = new Set(columns.map((c) => c.key));

/* --------------- selectors ----------------- */
const $ = (sel, ctx = document) => ctx.querySelector(sel);
const $$ = (sel, ctx = document) => [...ctx.querySelectorAll(sel)];

/* --------------- modal helpers ------------- */
function showModal(modal) {
  modal.style.display = "flex";
}
function hideModal(modal) {
  modal.style.display = "none";
}

/* ------------------------------------------------------------------
 * Settings helpers (persist on server)
 * ------------------------------------------------------------------ */
async function loadSettings() {
  const res = await fetch("/api/settings/visible_columns");
  if (res.ok) {
    const { value } = await res.json();
    if (Array.isArray(value)) visibleCols = new Set(value);
  }
}

async function saveSettings() {
  await fetch("/api/settings", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      key: "visible_columns",
      value: [...visibleCols]
    })
  });
}

[unchanged helper blocks...]

/* ------------------------------------------------------------------
 * Column-picker modal logic (⚙️)
 * ------------------------------------------------------------------ */
function openColModal() {
  const modal = $("#colModal");
  const boxContainer = $("#colCheckboxes");
  boxContainer.innerHTML = columns
    .map(
      (c) => `
      <label>
        <input type="checkbox" value="${c.key}" ${
        visibleCols.has(c.key) ? "checked" : ""
      } />
        ${c.label || c.key}
      </label>
    `
    )
    .join("<br/>");
  showModal(modal);
}

$("#gearBtn").addEventListener("click", openColModal);

$("#colSaveBtn").addEventListener("click", async () => {
  const checked = $$("#colCheckboxes input:checked").map((el) => el.value);
  visibleCols = new Set(checked);
  await saveSettings();
  hideModal($("#colModal"));
  await loadTasks();
});

$("#colCancelBtn").addEventListener("click", () => hideModal($("#colModal")));

/* click outside content closes modal */
$$(".modal").forEach((m) =>
  m.addEventListener("click", (e) => {
    if (e.target === m) hideModal(m);
  })
);

[rest of existing script unchanged]
</script>
</body>
</html>

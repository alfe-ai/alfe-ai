<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Printify Pipeline</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body style="padding:1rem;">
  <h2>PrintifyPipeline</h2>
  <ul id="stageList"></ul>
  <div id="fileContainer"></div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const file = params.get('file');
    const stageParam = parseInt(params.get('stage'));
    const stages = [
      { name: 'Generated (Initial Stage)' },
      { name: 'Upscaled' },
      { name: 'Background Removed' },
      { name: 'Border Added', disabled: true },
      { name: 'Printify Image Uploaded' },
      { name: 'Printify 2' },
      { name: 'Printify 3' },
      { name: 'Ebay Shipping Updated' },
      { name: 'Done' }
    ];

    const stageList = document.getElementById('stageList');
    const currentStage = isNaN(stageParam) ? 0 : Math.min(Math.max(stageParam, 0), stages.length - 1);
    stages.forEach((stage, idx) => {
      const li = document.createElement('li');
      li.textContent = stage.name;
      if (stage.disabled) li.classList.add('disabled');
      if (idx === currentStage) li.classList.add('current');
      stageList.appendChild(li);
    });

    const container = document.getElementById('fileContainer');
    if (file) {
      const ext = file.split('.').pop().toLowerCase();
      if (["png","jpg","jpeg","gif","webp","svg"].includes(ext)) {
        const img = document.createElement('img');
        img.src = `/uploads/${file}`;
        img.style.maxWidth = '100%';
        container.appendChild(img);
      } else {
        const link = document.createElement('a');
        link.href = `/uploads/${file}`;
        link.textContent = file;
        link.target = '_blank';
        container.appendChild(link);
      }
    } else {
      container.textContent = 'No file specified.';
    }
  </script>
</body>
</html>

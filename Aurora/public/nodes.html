<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Distributed Nodes</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 400px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
    }
    th {
      background: #f0f0f0;
      text-align: left;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    form {
      margin-top: 1rem;
    }
    input {
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
<h1>Distributed Nodes</h1>
<p><a href="/">&larr; Back</a></p>
<p>Current node: <span id="currentNode"></span></p>
<table id="nodesTable">
  <thead>
  <tr><th>Hostname</th><th>IP</th></tr>
  </thead>
  <tbody></tbody>
</table>
<form id="addForm">
  <input type="text" id="hostInput" placeholder="hostname" />
  <input type="text" id="ipInput" placeholder="ip" />
  <button type="submit">Add</button>
</form>
<script>
async function loadNodes(){
  const res = await fetch('/api/nodes');
  if(!res.ok) return;
  const data = await res.json();
  const nodeSpan = document.getElementById('currentNode');
  if(nodeSpan){
    const ip = (data.addresses && data.addresses[0]) ? ' ('+data.addresses[0]+')' : '';
    nodeSpan.textContent = data.host + ip;
  }
  const tbody = document.querySelector('#nodesTable tbody');
  tbody.innerHTML = '';
  (data.nodes || []).forEach(n => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${n.hostname||''}</td><td>${n.ip||''}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('addForm').addEventListener('submit', async e => {
  e.preventDefault();
  const hostname = document.getElementById('hostInput').value.trim();
  const ip = document.getElementById('ipInput').value.trim();
  await fetch('/api/nodes', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({hostname, ip})});
  document.getElementById('hostInput').value='';
  document.getElementById('ipInput').value='';
  loadNodes();
});

loadNodes();
</script>
</body>
</html>
